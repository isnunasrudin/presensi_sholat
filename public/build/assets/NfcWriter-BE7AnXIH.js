import{r as t,o as h,c as m,e as a,y as p,q as L,j as C,d as k,s as b,t as _,v as w}from"./vue-Bki0M6Jk.js";import{x as S}from"./primevue-BWgMG8pc.js";import{a as P}from"./app-Df4oPpsR.js";import{_ as B}from"./_plugin-vue_export-helper-DlAUqK2U.js";const D={class:"nfc-writer"},x={class:"writer-content"},T={class:"user-selection"},$={class:"filters"},G={class:"field"},z={class:"field"},M={key:0,class:"url-preview"},j={class:"url-display"},q={class:"write-section"},K={key:0,class:"nfc-not-supported"},H={__name:"NfcWriter",setup(J){const s=S(),N=t([]),v=t([]),d=t(null),i=t(null),n=t(""),g=t(!1),f=t(!1),o=t(!1),c=t(!1),r=t(null);h(()=>{"NDEFReader"in window?(c.value=!0,console.log("Web NFC API is supported")):(c.value=!1,console.log("Web NFC API is not supported"),s.add({severity:"warn",summary:"Peringatan",detail:"Web NFC API tidak didukung di browser ini. Fitur write NFC tidak akan berfungsi.",life:5e3}))});const U=async()=>{g.value=!0;try{const l=await P.get("/rombongan-belajar"),e=l.data.data||l.data;N.value=e.map(u=>({...u,nama_kelas:`${u.tingkat}-${u.nama_rombel}`}))}catch{s.add({severity:"error",summary:"Error",detail:"Gagal mengambil daftar kelas",life:3e3})}finally{g.value=!1}},W=async()=>{i.value=null,n.value="",d.value?await A(d.value):v.value=[]},A=async l=>{f.value=!0;try{const e=await P.get(`/users/by-class/${l}`);v.value=e.data||[]}catch{s.add({severity:"error",summary:"Error",detail:"Gagal mengambil daftar siswa untuk kelas ini",life:3e3}),v.value=[]}finally{f.value=!1}},E=()=>{i.value?n.value=`${window.location.origin}/u/${i.value}`:n.value=""},I=async()=>{try{await navigator.clipboard.writeText(n.value),s.add({severity:"success",summary:"Berhasil",detail:"URL telah disalin ke clipboard",life:3e3})}catch{s.add({severity:"error",summary:"Error",detail:"Gagal menyalin URL ke clipboard",life:3e3})}},R=async()=>{if(!c.value){s.add({severity:"error",summary:"Error",detail:"Web NFC API tidak didukung di browser ini. Gunakan Chrome/Edge di Android.",life:5e3});return}if(!i.value){s.add({severity:"warn",summary:"Peringatan",detail:"Harap pilih pengguna terlebih dahulu",life:3e3});return}if(!n.value){s.add({severity:"warn",summary:"Peringatan",detail:"URL tidak valid",life:3e3});return}o.value=!0,r.value=null;try{const l=new NDEFReader;s.add({severity:"info",summary:"Info",detail:"Dekatkan tag NFC ke perangkat Anda...",life:2e3}),await l.write({records:[{recordType:"url",data:n.value},{recordType:"text",data:n.value}]}),r.value={type:"success",icon:"pi pi-check-circle",message:`Berhasil menulis URL ke tag NFC untuk user ID: ${i.value}`},s.add({severity:"success",summary:"Berhasil",detail:`URL ${n.value} telah berhasil ditulis ke tag NFC`,life:5e3})}catch(l){console.error("NFC write error:",l);let e="Gagal menulis ke NFC";l.name==="NotAllowedError"?e="Izin NFC ditolak. Aktifkan NFC dan berikan izin melalui browser.":l.name==="NotSupportedError"?e="Perangkat tidak mendukung NFC.":l.name==="NetworkError"?e="Tag NFC tidak terdeteksi. Dekatkan tag ke perangkat dan coba lagi.":l.message&&(e=l.message),r.value={type:"error",icon:"pi pi-times-circle",message:e},s.add({severity:"error",summary:"Error",detail:e,life:5e3})}finally{o.value=!1}};return h(()=>{U()}),(l,e)=>{const u=C("Dropdown"),F=C("Button"),V=C("Card");return k(),m("div",D,[e[10]||(e[10]=a("div",{class:"page-header"},[a("h1",{class:"page-title"},"Write NFC Tag")],-1)),p(V,null,{content:L(()=>[a("div",x,[e[9]||(e[9]=a("div",{class:"info-section"},[a("h3",null,"Informasi Write NFC"),a("p",null,"Gunakan halaman ini untuk menulis URL ke tag NFC. Pastikan perangkat Anda mendukung Web NFC API.")],-1)),a("div",T,[e[4]||(e[4]=a("h3",null,"Pilih Pengguna",-1)),a("div",$,[a("div",G,[e[2]||(e[2]=a("label",{for:"classSelect"},"Kelas",-1)),p(u,{id:"classSelect",modelValue:d.value,"onUpdate:modelValue":e[0]||(e[0]=y=>d.value=y),options:N.value,optionLabel:"nama_kelas",optionValue:"id",placeholder:"Pilih kelas",loading:g.value,onChange:W,filter:""},null,8,["modelValue","options","loading"])]),a("div",z,[e[3]||(e[3]=a("label",{for:"userSelect"},"Pengguna",-1)),p(u,{id:"userSelect",modelValue:i.value,"onUpdate:modelValue":e[1]||(e[1]=y=>i.value=y),options:v.value,optionLabel:"name",optionValue:"id",placeholder:"Pilih pengguna",loading:f.value,disabled:!d.value,onChange:E,filter:""},null,8,["modelValue","options","loading","disabled"])])])]),i.value?(k(),m("div",M,[e[5]||(e[5]=a("h3",null,"URL yang akan ditulis",-1)),a("div",j,[a("p",null,_(n.value),1),p(F,{icon:"pi pi-copy",onClick:I,class:"p-button-outlined",label:"Salin URL"})])])):b("",!0),a("div",q,[e[7]||(e[7]=a("h3",null,"Write ke NFC",-1)),e[8]||(e[8]=a("div",{class:"write-instructions"},[a("p",null,"1. Pastikan NFC pada perangkat Anda aktif"),a("p",null,"2. Dekatkan tag NFC ke perangkat"),a("p",null,'3. Klik tombol "Write ke NFC" di bawah')],-1)),p(F,{label:o.value?"Menulis ke NFC...":"Write ke NFC",icon:o.value?"pi pi-spin pi-spinner":"pi pi-qrcode",onClick:R,disabled:!i.value||o.value||!c.value,class:w({"p-button-success":!o.value})},null,8,["label","icon","disabled","class"]),c.value?b("",!0):(k(),m("div",K,[...e[6]||(e[6]=[a("i",{class:"pi pi-exclamation-triangle"},null,-1),a("span",null,"Web NFC API tidak didukung di browser ini",-1)])]))]),r.value?(k(),m("div",{key:1,class:w(["write-result",r.value.type])},[a("i",{class:w(r.value.icon)},null,2),a("span",null,_(r.value.message),1)],2)):b("",!0)])]),_:1})])}}},Z=B(H,[["__scopeId","data-v-c9277112"]]);export{Z as default};
