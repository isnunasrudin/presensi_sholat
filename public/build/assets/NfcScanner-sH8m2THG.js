import{a as H,r as i,m as E,B as j,c as d,f as e,b as n,w as b,d as v,o as c,h as k,n as F,t as r,F as R,s as z,p as G}from"./app-CnZCGkoq.js";import{_ as J}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Y={class:"nfc-scanner"},q={class:"selection-form"},O={class:"field"},Q={class:"field"},W={class:"field"},X={key:0,class:"scan-status"},Z={key:1,class:"detected-card"},aa={class:"card-info"},ea={class:"card-details"},ta={class:"card-url"},sa={key:2,class:"user-info"},na={class:"user-card"},la={class:"user-details"},oa={class:"action-buttons"},ia={key:3,class:"scan-history"},ra={class:"history-content"},ua={class:"history-user"},da={class:"history-time"},ca={class:"confirmation-content"},pa={__name:"NfcScanner",setup(va){const p=H(),u=i(!1),m=i(new Date),y=i(null),f=i(null),l=i(null),g=i(!1),V=i(""),D=i([]),$=[{label:"Dhuhur",value:"dhuhur"},{label:"Dhuha",value:"dhuha"}];let B=null;const T=()=>{u.value?I():x()},x=()=>{if(!m.value||!y.value){p.add({severity:"warn",summary:"Peringatan",detail:"Harap pilih tanggal dan jenis sholat terlebih dahulu",life:3e3});return}u.value=!0,p.add({severity:"info",summary:"Scan Dimulai",detail:"Menunggu kartu NFC...",life:3e3})},I=()=>{u.value=!1,clearInterval(B),f.value=null,l.value=null,p.add({severity:"info",summary:"Scan Dihentikan",detail:"Scan NFC telah dihentikan",life:3e3})},_=t=>{g.value=!0},C=async t=>{try{g.value=!1;const a=await G.post("/prayer-records",{user_id:l.value.id,prayer_type:y.value,date:L(m.value),status:t,notes:`Dicatat melalui scan NFC pada ${new Date().toLocaleString("id-ID")}`});D.value.unshift({userName:l.value.name,status:t,statusLabel:N(t),time:new Date().toLocaleTimeString()}),f.value=null,l.value=null,p.add({severity:"success",summary:"Berhasil",detail:`Kehadiran ${l.value?.name||"pengguna"} telah dicatat sebagai ${N(t)}`,life:3e3})}catch(a){p.add({severity:"error",summary:"Error",detail:"Gagal mencatat kehadiran: "+(a.response?.data?.message||a.message),life:3e3})}},L=t=>{if(!t)return null;const a=new Date(t),S=a.getFullYear(),w=String(a.getMonth()+1).padStart(2,"0"),o=String(a.getDate()).padStart(2,"0");return`${S}-${w}-${o}`},N=t=>{switch(t){case"sholat":return"Sholat";case"tidak_sholat":return"Tidak Sholat";case"halangan":return"Halangan";default:return t}},M=t=>t.toLocaleDateString("id-ID",{day:"numeric",month:"long",year:"numeric"});return E(()=>{"NDEFReader"in window?console.log("NFC is supported"):(console.log("NFC is not supported in this browser"),p.add({severity:"warn",summary:"Peringatan",detail:"NFC tidak didukung di browser ini. Menggunakan simulasi.",life:5e3}))}),j(()=>{}),(t,a)=>{const S=v("Calendar"),w=v("Dropdown"),o=v("Button"),K=v("DataView"),P=v("Card"),U=v("Dialog");return c(),d("div",Y,[a[20]||(a[20]=e("div",{class:"page-header"},[e("h1",{class:"page-title"},"Scan NFC Kehadiran Sholat")],-1)),n(P,null,{content:b(()=>[e("div",q,[e("div",O,[a[8]||(a[8]=e("label",{for:"prayerDate"},"Tanggal Sholat",-1)),n(S,{id:"prayerDate",modelValue:m.value,"onUpdate:modelValue":a[0]||(a[0]=s=>m.value=s),dateFormat:"yy-mm-dd",showIcon:!0,maxDate:new Date},null,8,["modelValue","maxDate"])]),e("div",Q,[a[9]||(a[9]=e("label",{for:"prayerType"},"Jenis Sholat",-1)),n(w,{id:"prayerType",modelValue:y.value,"onUpdate:modelValue":a[1]||(a[1]=s=>y.value=s),options:$,optionLabel:"label",optionValue:"value",placeholder:"Pilih jenis sholat"},null,8,["modelValue"])]),e("div",W,[a[10]||(a[10]=e("label",null,"Â ",-1)),n(o,{label:u.value?"Hentikan Scan":"Mulai Scan",icon:u.value?"pi pi-stop":"pi pi-play",onClick:T,class:F(u.value?"p-button-danger":"p-button-success")},null,8,["label","icon","class"])])]),u.value?(c(),d("div",X,[...a[11]||(a[11]=[e("div",{class:"status-indicator"},[e("i",{class:"pi pi-wifi status-icon"}),e("span",null,"Menunggu kartu NFC...")],-1)])])):k("",!0),f.value?(c(),d("div",Z,[a[14]||(a[14]=e("h3",null,"Kartu Terdeteksi",-1)),e("div",aa,[a[13]||(a[13]=e("i",{class:"pi pi-user card-icon"},null,-1)),e("div",ea,[e("p",ta,r(f.value.url),1),a[12]||(a[12]=e("p",{class:"card-status"},"Memproses data pengguna...",-1))])])])):k("",!0),l.value?(c(),d("div",sa,[a[16]||(a[16]=e("h3",null,"Informasi Pengguna",-1)),e("div",na,[a[15]||(a[15]=e("div",{class:"user-avatar"},[e("i",{class:"pi pi-user"})],-1)),e("div",la,[e("h4",null,r(l.value.name),1),e("p",null,r(l.value.email),1)])]),e("div",oa,[n(o,{label:"Sholat",icon:"pi pi-check",onClick:a[2]||(a[2]=s=>_("sholat")),class:"p-button-success"}),n(o,{label:"Berhalangan",icon:"pi pi-times",onClick:a[3]||(a[3]=s=>_("halangan")),class:"p-button-warning"})])])):k("",!0),D.value.length>0?(c(),d("div",ia,[a[18]||(a[18]=e("h3",null,"Riwayat Scan Terbaru",-1)),n(K,{value:D.value,paginator:!0,rows:5},{list:b(s=>[(c(!0),d(R,null,z(s.items,(h,A)=>(c(),d("div",{class:"history-item",key:A},[e("div",ra,[e("div",ua,[a[17]||(a[17]=e("i",{class:"pi pi-user"},null,-1)),e("span",null,r(h.userName),1)]),e("div",{class:F(["history-status",h.status])},r(h.statusLabel),3),e("div",da,r(h.time),1)])]))),128))]),_:1},8,["value"])])):k("",!0)]),_:1}),n(U,{visible:g.value,"onUpdate:visible":a[7]||(a[7]=s=>g.value=s),style:{width:"450px"},header:"Konfirmasi Kehadiran",modal:!0},{footer:b(()=>[n(o,{label:"Batal",icon:"pi pi-times",onClick:a[4]||(a[4]=s=>g.value=!1),class:"p-button-text"}),n(o,{label:"Berhalangan",icon:"pi pi-times",onClick:a[5]||(a[5]=s=>C("halangan")),class:"p-button-warning"}),n(o,{label:"Sholat",icon:"pi pi-check",onClick:a[6]||(a[6]=s=>C("sholat")),class:"p-button-success"})]),default:b(()=>[e("div",ca,[a[19]||(a[19]=e("i",{class:"pi pi-exclamation-triangle"},null,-1)),e("span",null,"Apakah "+r(V.value)+" melakukan sholat pada "+r(M(m.value))+"?",1)])]),_:1},8,["visible"])])}}},ya=J(pa,[["__scopeId","data-v-ad0231ab"]]);export{ya as default};
