import{r as m,o as S,c,e,s as _,y as o,h as s,j as x,p as U,q as i,d as r,D as h,v as V,t as b,F as z,A as G}from"./vue-Bki0M6Jk.js";import{x as L}from"./primevue-BWgMG8pc.js";import{a as C}from"./app-CaNKOdJ-.js";import{_ as N}from"./_plugin-vue_export-helper-DlAUqK2U.js";const $={class:"user-import-page"},A={class:"header-section"},O={class:"header-content"},P={class:"main-grid"},q={class:"import-form"},J={class:"upload-section"},K={key:0,class:"upload-placeholder"},X={key:1,class:"selected-file"},H={class:"file-details"},W={class:"import-actions"},Q={class:"template-content"},Y={class:"rombel-content"},Z={key:0,class:"rombel-list"},ee={key:1,class:"no-rombel"},le={class:"success-content"},ae={class:"success-message"},se={key:0,class:"loading-overlay"},te={class:"loading-content"},ne={__name:"UserImport",setup(oe){const d=L(),n=m(null),g=m(!1),k=m(!1),f=m(!1),y=m(!1),w=m([]),p=m(null),B=a=>{const l=a.target.files[0];l&&F(l)},D=a=>{y.value=!1;const l=a.dataTransfer.files[0];l&&F(l)},F=a=>{if(!["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-excel","text/csv","text/plain"].includes(a.type)&&!a.name.match(/\.(xlsx|xls|csv|txt)$/i)){d.add({severity:"error",summary:"Error",detail:"Format file tidak didukung. Gunakan Excel (.xlsx, .xls) atau CSV (.csv)",life:5e3});return}if(a.size>20*1024*1024){d.add({severity:"error",summary:"Error",detail:"Ukuran file terlalu besar. Maksimal 20MB",life:5e3});return}n.value=a,p.value=null},E=()=>{n.value=null,p.value=null,document.querySelector(".file-input")&&(document.querySelector(".file-input").value="")},M=a=>{if(a===0)return"0 Bytes";const l=1024,t=["Bytes","KB","MB","GB"],u=Math.floor(Math.log(a)/Math.log(l));return parseFloat((a/Math.pow(l,u)).toFixed(2))+" "+t[u]},T=async()=>{if(!n.value){d.add({severity:"warn",summary:"Validasi",detail:"Silakan pilih file terlebih dahulu",life:3e3});return}g.value=!0;try{const a=new FormData;a.append("file",n.value);const l=await C.post("/users/import",a,{headers:{"Content-Type":"multipart/form-data"}});if(l.data.success)p.value=l.data.data,d.add({severity:"success",summary:"Import Berhasil",detail:"File telah ditambahkan ke antrian dan akan diproses secara otomatis",life:5e3}),n.value=null,window.dispatchEvent(new CustomEvent("users-imported"));else throw new Error(l.data.message)}catch(a){console.error("Import error:",a);let l="Gagal import users";if(a.response?.data?.errors){const t=a.response.data.errors;l=Object.values(t).flat().join(", ")}else a.response?.data?.message?l=a.response.data.message:a.message&&(l=a.message);d.add({severity:"error",summary:"Import Gagal",detail:l,life:5e3})}finally{g.value=!1}},j=async()=>{k.value=!0;try{const a=await C.get("/users/import/template",{responseType:"blob"}),l=window.URL.createObjectURL(new Blob([a.data])),t=document.createElement("a");t.href=l,t.setAttribute("download","template_import_users_enhanced.csv"),document.body.appendChild(t),t.click(),document.body.removeChild(t),window.URL.revokeObjectURL(l),d.add({severity:"success",summary:"Download Berhasil",detail:"Template berhasil diunduh",life:3e3})}catch(a){console.error("Download template error:",a),d.add({severity:"error",summary:"Download Gagal",detail:"Gagal mengunduh template",life:3e3})}finally{k.value=!1}},I=async()=>{f.value=!0;try{const a=await C.get("/users/import/rombel");if(a.data.success)w.value=a.data.data.available_rombel;else throw new Error(a.data.message)}catch(a){console.error("Load rombel error:",a),d.add({severity:"error",summary:"Error",detail:"Gagal memuat data rombel",life:3e3})}finally{f.value=!1}};return S(()=>{I()}),(a,l)=>{const t=x("Button"),u=x("Card"),R=x("ProgressSpinner");return r(),c("div",$,[e("div",A,[e("div",O,[l[4]||(l[4]=e("div",{class:"header-info"},[e("h1",{class:"page-title"},[e("i",{class:"pi pi-upload"}),s(" Import Users ")]),e("p",{class:"page-description"}," Import data pengguna dari file Excel atau CSV dengan auto-creation rombel ")],-1)),o(t,{icon:"pi pi-arrow-left",label:"Kembali",onClick:l[0]||(l[0]=v=>a.$router.push("/users")),class:"back-btn",size:"small"})])]),e("div",P,[o(u,{class:"import-form-card"},{title:i(()=>[...l[5]||(l[5]=[e("div",{class:"card-title"},[e("i",{class:"pi pi-file-import"}),s(" Upload File Import ")],-1)])]),content:i(()=>[e("div",q,[e("div",J,[e("div",{class:V(["upload-area",{"drag-over":y.value,"has-file":n.value}]),onDragover:l[1]||(l[1]=h(v=>y.value=!0,["prevent"])),onDragleave:l[2]||(l[2]=h(v=>y.value=!1,["prevent"])),onDrop:h(D,["prevent"]),onClick:l[3]||(l[3]=v=>a.$refs.fileInput.click())},[n.value?(r(),c("div",X,[l[7]||(l[7]=e("i",{class:"pi pi-file"},null,-1)),e("div",H,[e("h4",null,b(n.value.name),1),e("p",null,b(M(n.value.size)),1)]),o(t,{icon:"pi pi-times",onClick:h(E,["stop"]),class:"remove-file-btn",text:"",rounded:""})])):(r(),c("div",K,[...l[6]||(l[6]=[e("i",{class:"pi pi-cloud-upload"},null,-1),e("h3",null,"Drag & Drop File",-1),e("p",null,"atau klik untuk memilih file",-1),e("small",{class:"file-info"},"Mendukung: Excel (.xlsx, .xls) atau CSV (.csv) - Max 20MB",-1)])])),e("input",{ref:"fileInput",type:"file",accept:".xlsx,.xls,.csv,.txt",onChange:B,style:{display:"none"}},null,544)],34)]),e("div",W,[o(t,{onClick:T,disabled:!n.value||g.value,loading:g.value,label:"Import Users",icon:"pi pi-upload",class:"import-btn"},null,8,["disabled","loading"])])])]),_:1}),o(u,{class:"template-card"},{title:i(()=>[...l[8]||(l[8]=[e("div",{class:"card-title"},[e("i",{class:"pi pi-download"}),s(" Template Import ")],-1)])]),content:i(()=>[e("div",Q,[l[9]||(l[9]=e("p",{class:"template-description"}," Download template untuk format import yang benar ",-1)),o(t,{onClick:j,disabled:k.value,loading:k.value,label:"Download Template",icon:"pi pi-file-download",class:"template-btn"},null,8,["disabled","loading"])])]),_:1}),o(u,{class:"instructions-card"},{title:i(()=>[...l[10]||(l[10]=[e("div",{class:"card-title"},[e("i",{class:"pi pi-info-circle"}),s(" Petunjuk Import ")],-1)])]),content:i(()=>[...l[11]||(l[11]=[e("div",{class:"instructions-content"},[e("div",{class:"instruction-section"},[e("h4",null,"Field Wajib (*)"),e("ul",null,[e("li",null,[e("strong",null,"name*"),s(" - Nama lengkap user")]),e("li",null,[e("strong",null,"role*"),s(" - Role (admin/user)")]),e("li",null,[e("strong",null,"tahun_angkatan*"),s(" - Tahun angkatan (contoh: 2024) [tabel: rombongan_belajar]")]),e("li",null,[e("strong",null,"nama_rombel*"),s(" - Nama rombel (contoh: XII-A) [tabel: rombongan_belajar]")]),e("li",null,[e("strong",null,"tingkat*"),s(" - Tingkat kelas (contoh: XII) [tabel: rombongan_belajar]")])])]),e("div",{class:"instruction-section"},[e("h4",null,"Field Opsional"),e("ul",null,[e("li",null,[e("strong",null,"email"),s(" - Email (akan digenerate otomatis jika kosong)")]),e("li",null,[e("strong",null,"nisn"),s(" - Nomor induk siswa nasional (opsional, max 20 karakter)")]),e("li",null,[e("strong",null,"gender"),s(" - Jenis kelamin (L/P)")])])]),e("div",{class:"instruction-section"},[e("h4",null,"Auto-Creation Rombel (Tabel: rombongan_belajar)"),e("ul",null,[e("li",null,[e("strong",null,"Rombel baru akan dibuat otomatis"),s(" jika belum ada di tabel")]),e("li",null,[s("Sistem akan mencocokkan berdasarkan "),e("strong",null,"nama_rombel + tingkat + tahun_angkatan")]),e("li",null,"Jika rombel sudah ada, user akan langsung diattach ke rombel tersebut"),e("li",null,[s("Field di tabel: "),e("code",null,"nama_rombel"),s(", "),e("code",null,"tingkat"),s(", "),e("code",null,"tahun_angkatan")])])]),e("div",{class:"instruction-section"},[e("h4",null,"Catatan"),e("ul",null,[e("li",null,[s("Password default: "),e("code",null,"password")]),e("li",null,"Email akan digenerate otomatis jika tidak diisi (format: namasiswa@snesa.local)"),e("li",null,"Hanya admin yang bisa melakukan import"),e("li",null,"File yang error akan dilewati dengan pesan error"),e("li",null,"Rombel yang sama tidak akan dibuat duplikatnya")])])],-1)])]),_:1}),o(u,{class:"rombel-card"},{title:i(()=>[...l[12]||(l[12]=[e("div",{class:"card-title"},[e("i",{class:"pi pi-users"}),s(" Rombel Tersedia ")],-1)])]),content:i(()=>[e("div",Y,[o(t,{onClick:I,disabled:f.value,loading:f.value,label:"Refresh Rombel",icon:"pi pi-refresh",severity:"secondary",size:"small",class:"refresh-rombel-btn"},null,8,["disabled","loading"]),w.value.length>0?(r(),c("div",Z,[(r(!0),c(z,null,G(w.value,v=>(r(),c("div",{key:v,class:"rombel-chip"},b(v),1))),128))])):f.value?_("",!0):(r(),c("div",ee,[...l[13]||(l[13]=[e("i",{class:"pi pi-info-circle"},null,-1),e("p",null,"Belum ada data rombel",-1)])]))])]),_:1}),p.value?(r(),U(u,{key:0,class:"success-card"},{title:i(()=>[...l[14]||(l[14]=[e("div",{class:"card-title"},[e("i",{class:"pi pi-check-circle"}),s(" Import Berhasil ")],-1)])]),content:i(()=>[e("div",le,[e("div",ae,[l[16]||(l[16]=e("i",{class:"pi pi-check-circle"},null,-1)),e("div",null,[l[15]||(l[15]=e("h3",null,"File sedang diproses",-1)),e("p",null,b(p.value.file_name)+" telah ditambahkan ke antrian dan akan diproses secara otomatis.",1),e("p",null,[e("strong",null,"Estimasi waktu: "+b(p.value.estimated_time),1)])])])])]),_:1})):_("",!0)]),g.value?(r(),c("div",se,[e("div",te,[o(R),l[17]||(l[17]=e("h3",null,"Mengimport Users...",-1)),l[18]||(l[18]=e("p",null,"Mohon tunggu, sedang memproses file",-1))])])):_("",!0)])}}},ce=N(ne,[["__scopeId","data-v-3d9e566e"]]);export{ce as default};
