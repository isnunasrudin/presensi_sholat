import{r,w as $,o as O,c as x,e,s as A,y as i,h as E,j as B,p as F,q as p,d as h,t as y,F as q,A as G,v as J}from"./vue-Bki0M6Jk.js";import{x as z}from"./primevue-BWgMG8pc.js";import{a as C}from"./app-CaNKOdJ-.js";import{_ as I}from"./_plugin-vue_export-helper-DlAUqK2U.js";const H={class:"excel-export-page"},Q={class:"header-section"},W={class:"header-content"},X={class:"main-grid"},Z={class:"export-form"},ee={class:"export-section"},ae={class:"form-grid"},le={class:"form-group"},se={class:"form-group"},te={class:"export-section"},oe={class:"form-grid"},ie={class:"form-group"},ne={class:"form-group"},re={class:"form-group"},de={key:0,class:"stats-content"},ue={class:"stats-grid"},ce={class:"stat-item"},ve={class:"stat-value"},pe={class:"stat-item"},me={class:"stat-value"},be={class:"stat-item"},he={class:"stat-value"},fe={class:"stat-item"},ye={class:"stat-value"},ge={key:1,class:"no-stats"},ke={class:"quick-actions"},xe={class:"months-content"},_e={class:"months-grid"},we=["onClick"],Ee={class:"month-name"},Ce={key:0,class:"loading-overlay"},De={class:"loading-content"},Ve={__name:"ExcelExport",setup(Be){const c=z(),n=r(!1),m=r(!1),D=r([]),_=r([]),v=r(null),o=r(""),d=r(new Date().getFullYear()),g=r(""),f=r(""),V=r(new Date().getFullYear()),w=r([{value:1,label:"Januari"},{value:2,label:"Februari"},{value:3,label:"Maret"},{value:4,label:"April"},{value:5,label:"Mei"},{value:6,label:"Juni"},{value:7,label:"Juli"},{value:8,label:"Agustus"},{value:9,label:"September"},{value:10,label:"Oktober"},{value:11,label:"November"},{value:12,label:"Desember"}]),T=new Date().getFullYear(),L=r(Array.from({length:T-2020+1},(l,a)=>2020+a)),U=async()=>{try{const l=await C.get("/rombongan-belajar"),a=l.data.data||l.data;D.value=Array.isArray(a)?a:[]}catch(l){console.error("Error fetching classes:",l),D.value=[],l.response?.status===401&&c.add({severity:"warn",summary:"Sesi Expired",detail:"Silakan login kembali",life:3e3})}},M=async()=>{try{const a=(await C.get(`/export/available-months?year=${d.value}`)).data;_.value=Array.isArray(a)?a:[]}catch(l){console.error("Error fetching available months:",l),_.value=[]}},S=async()=>{if(!o.value){v.value=null;return}try{const l=await C.get(`/export/month-statistics?month=${o.value}&year=${d.value}`);v.value=l.data}catch(l){console.error("Error fetching statistics:",l),v.value=null}},R=async()=>{if(!o.value){c.add({severity:"warn",summary:"Validasi",detail:"Silakan pilih bulan terlebih dahulu",life:3e3});return}n.value=!0;try{const l=await C.get("/export/monthly-recap",{params:{month:o.value,year:d.value},responseType:"blob"}),a=window.URL.createObjectURL(new Blob([l.data])),t=document.createElement("a");t.href=a;const u=`Rekap-Sholat-${w.value.find(k=>k.value===o.value)?.label||o.value}-${d.value}.xlsx`;t.setAttribute("download",u),document.body.appendChild(t),t.click(),document.body.removeChild(t),window.URL.revokeObjectURL(a),c.add({severity:"success",summary:"Export Berhasil",detail:`File "${u}" berhasil diunduh`,life:5e3})}catch(l){console.error("Error exporting:",l),c.add({severity:"error",summary:"Export Gagal",detail:"Gagal export data",life:3e3})}finally{n.value=!1}},N=async()=>{if(!g.value||!f.value){c.add({severity:"warn",summary:"Validasi",detail:"Silakan pilih kelas dan bulan terlebih dahulu",life:3e3});return}m.value=!0;try{const l=await C.get(`/export/class/${g.value}`,{params:{month:f.value,year:V.value},responseType:"blob"}),a=window.URL.createObjectURL(new Blob([l.data])),t=document.createElement("a");t.href=a;const b=D.value.find(s=>s.id===g.value)?.nama_rombel||"Kelas",u=w.value.find(s=>s.value===f.value)?.label||f.value,k=`Rekap-Sholat-${b}-${u}-${V.value}.xlsx`;t.setAttribute("download",k),document.body.appendChild(t),t.click(),document.body.removeChild(t),window.URL.revokeObjectURL(a),c.add({severity:"success",summary:"Export Berhasil",detail:`File "${k}" berhasil diunduh`,life:5e3})}catch(l){console.error("Error exporting:",l),c.add({severity:"error",summary:"Export Gagal",detail:"Gagal export data",life:3e3})}finally{m.value=!1}},P=l=>{o.value=l,c.add({severity:"info",summary:"Bulan Dipilih",detail:`Bulan ${w.value.find(a=>a.value===l)?.label} telah dipilih`,life:2e3})},Y=()=>{const l=new Date().getMonth()+1;o.value=l,d.value=new Date().getFullYear(),R()},K=()=>{const l=new Date;l.setMonth(l.getMonth()-1),o.value=l.getMonth()+1,d.value=l.getFullYear(),R()},j=()=>{U(),M(),o.value&&S(),c.add({severity:"success",summary:"Data Di-refresh",detail:"Data telah diperbarui",life:2e3})};return $(d,()=>{M(),o.value&&S()}),$(o,()=>{S()}),O(()=>{U(),M()}),(l,a)=>{const t=B("Button"),b=B("Dropdown"),u=B("Card"),k=B("ProgressSpinner");return h(),x("div",H,[e("div",Q,[e("div",W,[a[5]||(a[5]=e("div",{class:"header-info"},[e("h1",{class:"page-title"},[e("i",{class:"pi pi-file-excel"}),E(" Export Data Sholat ")]),e("p",{class:"page-description"}," Export data kehadiran sholat dhuhur dan dhuha ke dalam format Excel ")],-1)),i(t,{icon:"pi pi-refresh",label:"Refresh",onClick:j,disabled:n.value,class:"refresh-btn",size:"small"},null,8,["disabled"])])]),e("div",X,[i(u,{class:"export-options-card"},{title:p(()=>[...a[6]||(a[6]=[e("div",{class:"card-title"},[e("i",{class:"pi pi-cog"}),E(" Opsi Export ")],-1)])]),content:p(()=>[e("div",Z,[e("div",ee,[a[9]||(a[9]=e("div",{class:"section-header"},[e("div",{class:"section-icon monthly"},[e("i",{class:"pi pi-calendar"})]),e("div",{class:"section-info"},[e("h3",null,"Rekap Bulanan"),e("p",null,"Export semua kelas dalam satu bulan")])],-1)),e("div",ae,[e("div",le,[a[7]||(a[7]=e("label",null,"Bulan",-1)),i(b,{modelValue:o.value,"onUpdate:modelValue":a[0]||(a[0]=s=>o.value=s),options:w.value,optionLabel:"label",optionValue:"value",placeholder:"Pilih Bulan",class:"w-full",disabled:n.value},null,8,["modelValue","options","disabled"])]),e("div",se,[a[8]||(a[8]=e("label",null,"Tahun",-1)),i(b,{modelValue:d.value,"onUpdate:modelValue":a[1]||(a[1]=s=>d.value=s),options:L.value,placeholder:"Pilih Tahun",class:"w-full",disabled:n.value},null,8,["modelValue","options","disabled"])])]),i(t,{onClick:R,disabled:n.value||!o.value,loading:n.value,label:"Export Rekap Bulanan",icon:"pi pi-download",class:"export-btn monthly"},null,8,["disabled","loading"])]),e("div",te,[a[13]||(a[13]=e("div",{class:"section-header"},[e("div",{class:"section-icon class-specific"},[e("i",{class:"pi pi-users"})]),e("div",{class:"section-info"},[e("h3",null,"Per Kelas"),e("p",null,"Export data untuk kelas tertentu")])],-1)),e("div",oe,[e("div",ie,[a[10]||(a[10]=e("label",null,"Kelas",-1)),i(b,{modelValue:g.value,"onUpdate:modelValue":a[2]||(a[2]=s=>g.value=s),options:D.value,optionLabel:"nama_rombel",optionValue:"id",placeholder:"Pilih Kelas",class:"w-full",disabled:m.value,filter:""},null,8,["modelValue","options","disabled"])]),e("div",ne,[a[11]||(a[11]=e("label",null,"Bulan",-1)),i(b,{modelValue:f.value,"onUpdate:modelValue":a[3]||(a[3]=s=>f.value=s),options:w.value,optionLabel:"label",optionValue:"value",placeholder:"Pilih Bulan",class:"w-full",disabled:m.value},null,8,["modelValue","options","disabled"])]),e("div",re,[a[12]||(a[12]=e("label",null,"Tahun",-1)),i(b,{modelValue:V.value,"onUpdate:modelValue":a[4]||(a[4]=s=>V.value=s),options:L.value,placeholder:"Pilih Tahun",class:"w-full",disabled:m.value},null,8,["modelValue","options","disabled"])])]),i(t,{onClick:N,disabled:m.value||!g.value||!f.value,loading:m.value,label:"Export Data Kelas",icon:"pi pi-download",class:"export-btn class-specific"},null,8,["disabled","loading"])])])]),_:1}),i(u,{class:"stats-card"},{title:p(()=>[...a[14]||(a[14]=[e("div",{class:"card-title"},[e("i",{class:"pi pi-chart-bar"}),E(" Statistik Data ")],-1)])]),content:p(()=>[v.value?(h(),x("div",de,[e("h4",null,"Statistik "+y(v.value.month_name)+" "+y(d.value),1),e("div",ue,[e("div",ce,[e("div",ve,y(v.value.total_students),1),a[15]||(a[15]=e("div",{class:"stat-label"},"Total Siswa",-1))]),e("div",pe,[e("div",me,y(v.value.total_records),1),a[16]||(a[16]=e("div",{class:"stat-label"},"Total Record",-1))]),e("div",be,[e("div",he,y(v.value.total_present),1),a[17]||(a[17]=e("div",{class:"stat-label"},"Sholat Hadir",-1))]),e("div",fe,[e("div",ye,y(v.value.attendance_rate)+"%",1),a[18]||(a[18]=e("div",{class:"stat-label"},"Kehadiran",-1))])])])):(h(),x("div",ge,[...a[19]||(a[19]=[e("i",{class:"pi pi-info-circle"},null,-1),e("p",null,"Pilih bulan untuk melihat statistik",-1)])]))]),_:1}),i(u,{class:"quick-actions-card"},{title:p(()=>[...a[20]||(a[20]=[e("div",{class:"card-title"},[e("i",{class:"pi pi-bolt"}),E(" Aksi Cepat ")],-1)])]),content:p(()=>[e("div",ke,[i(t,{onClick:Y,disabled:n.value,loading:n.value,label:"Export Bulan Ini",icon:"pi pi-calendar",severity:"success",class:"quick-btn"},null,8,["disabled","loading"]),i(t,{onClick:K,disabled:n.value,loading:n.value,label:"Export Bulan Lalu",icon:"pi pi-calendar-minus",severity:"info",class:"quick-btn"},null,8,["disabled","loading"])])]),_:1}),_.value.length>0?(h(),F(u,{key:0,class:"months-card"},{title:p(()=>[...a[21]||(a[21]=[e("div",{class:"card-title"},[e("i",{class:"pi pi-calendar-times"}),E(" Data Tersedia ")],-1)])]),content:p(()=>[e("div",xe,[a[22]||(a[22]=e("p",{class:"months-description"},"Klik bulan untuk memilih data yang akan diekspor:",-1)),e("div",_e,[(h(!0),x(q,null,G(_.value,s=>(h(),x("div",{key:s.value,onClick:Me=>P(s.value),class:J(["month-chip",{active:o.value===s.value}])},[e("span",Ee,y(s.label),1)],10,we))),128))])])]),_:1})):A("",!0),_.value.length===0&&!n.value?(h(),F(u,{key:1,class:"empty-card"},{content:p(()=>[...a[23]||(a[23]=[e("div",{class:"empty-state"},[e("i",{class:"pi pi-folder-open"}),e("h3",null,"Belum Ada Data"),e("p",null,"Tidak ada data sholat yang tersedia untuk diekspor")],-1)])]),_:1})):A("",!0)]),n.value||m.value?(h(),x("div",Ce,[e("div",De,[i(k),a[24]||(a[24]=e("h3",null,"Sedang Export...",-1)),a[25]||(a[25]=e("p",null,"Mohon tunggu, sedang memproses data",-1))])])):A("",!0)])}}},Ue=I(Ve,[["__scopeId","data-v-4c74c3b6"]]);export{Ue as default};
