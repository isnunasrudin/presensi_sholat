import{u as le,a as se,q as oe,r as y,m as ne,c as p,f as t,b as s,l as x,h as r,j as k,w as _,d as g,p as T,o as n,F as ie,s as re,t as d,i as F,n as S,g as de}from"./app-CnZCGkoq.js";import{_ as ue}from"./_plugin-vue_export-helper-DlAUqK2U.js";const pe={class:"prayer-records"},ce={class:"page-header"},ve={class:"filters"},me={key:0,class:"filter-group"},ye={class:"filter-group"},_e={class:"filter-group"},ge={class:"filter-group"},fe={class:"record-header"},be={class:"record-main-info"},he={class:"prayer-type"},ke={class:"record-date"},Ve={class:"record-details"},Ce={key:0,class:"detail-item"},Se={class:"detail-content"},we={class:"detail-value"},De={key:1,class:"detail-item notes-item"},Te={class:"detail-content"},Ae={class:"detail-value"},Pe={key:0,class:"item-actions"},xe={class:"action-buttons"},Fe={key:0,class:"field"},Ue={key:0,class:"p-error"},$e={class:"field"},Le={key:0,class:"p-error"},Re={class:"field"},Be={key:0,class:"p-error"},Ee={class:"field"},Me={key:0,class:"p-error"},ze={class:"field"},He={class:"dialog-actions"},Ne={__name:"PrayerRecords",setup(Ie){const c=le(),V=se(),J=oe(),U=y([]),$=y([]),A=y(!1),L=y(!1),w=y(!1),P=y("create"),i=y({}),v=y({user_id:null,prayer_type:null,start_date:null,end_date:null}),f=y({current_page:1,per_page:15,total:0}),E=[{label:"All",value:null},{label:"Dhuhur",value:"dhuhur"},{label:"Dhuha",value:"dhuha"}],j=[{label:"Sholat",value:"sholat"},{label:"Tidak Sholat",value:"tidak_sholat"},{label:"Halangan",value:"halangan"}],o=y({id:null,user_id:null,prayer_type:null,date:new Date,status:null,notes:""}),q=async()=>{if(c.isAdmin)try{const a=await T.get("/users");$.value=a.data.data||a.data}catch(a){console.error("Failed to fetch users:",a)}},b=async()=>{A.value=!0;try{const a={page:f.value.current_page,...v.value};a.start_date&&(a.start_date=B(a.start_date)),a.end_date&&(a.end_date=B(a.end_date));const e=await T.get("/prayer-records",{params:a});U.value=e.data.data,f.value={current_page:e.data.current_page,per_page:e.data.per_page,total:e.data.total}}catch{V.add({severity:"error",summary:"Error",detail:"Failed to fetch records",life:3e3})}finally{A.value=!1}},R=(a=null)=>{i.value={},a?(P.value="edit",o.value={id:a.id,user_id:a.user_id,prayer_type:a.prayer_type,date:new Date(a.date),status:a.status,notes:a.notes||""}):(P.value="create",o.value={id:null,user_id:c.isAdmin?null:c.user.id,prayer_type:null,date:new Date,status:null,notes:""}),w.value=!0},O=async()=>{i.value={},L.value=!0;try{const a={prayer_type:o.value.prayer_type,date:B(o.value.date),status:o.value.status,notes:o.value.notes};c.isAdmin&&(a.user_id=o.value.user_id),P.value==="edit"?(await T.put(`/prayer-records/${o.value.id}`,a),V.add({severity:"success",summary:"Success",detail:"Record updated successfully",life:3e3})):(await T.post("/prayer-records",a),V.add({severity:"success",summary:"Success",detail:"Record created successfully",life:3e3})),w.value=!1,b()}catch(a){a.response?.data?.errors?i.value=a.response.data.errors:V.add({severity:"error",summary:"Error",detail:a.response?.data?.message||"Failed to save record",life:3e3})}finally{L.value=!1}},M=a=>{J.require({message:"Are you sure you want to delete this record?",header:"Confirm Delete",icon:"pi pi-exclamation-triangle",accept:()=>Y(a.id)})},Y=async a=>{try{await T.delete(`/prayer-records/${a}`),V.add({severity:"success",summary:"Success",detail:"Record deleted successfully",life:3e3}),b()}catch{V.add({severity:"error",summary:"Error",detail:"Failed to delete record",life:3e3})}},G=()=>{v.value={user_id:null,prayer_type:null,start_date:null,end_date:null},b()},K=a=>{f.value.current_page=a.page+1,b()},z=a=>new Date(a).toLocaleDateString("id-ID",{day:"numeric",month:"long",year:"numeric"}),B=a=>{if(!a)return null;const e=new Date(a),m=e.getFullYear(),h=String(e.getMonth()+1).padStart(2,"0"),D=String(e.getDate()).padStart(2,"0");return`${m}-${h}-${D}`},H=a=>a.charAt(0).toUpperCase()+a.slice(1),N=a=>({sholat:"Sholat",tidak_sholat:"Tidak Sholat",halangan:"Halangan"})[a]||a,I=a=>({sholat:"status-badge success",tidak_sholat:"status-badge danger",halangan:"status-badge warning"})[a]||"status-badge";return ne(()=>{b(),q()}),(a,e)=>{const m=g("Button"),h=g("Dropdown"),D=g("Calendar"),Q=g("DataView"),C=g("Column"),W=g("DataTable"),X=g("Paginator"),Z=g("Card"),ee=g("Textarea"),ae=g("Dialog");return n(),p("div",pe,[t("div",ce,[e[12]||(e[12]=t("h1",{class:"page-title"},"Catatan Sholat",-1)),k(c).isAdmin?(n(),x(m,{key:0,label:"Tambah Catatan",icon:"pi pi-plus",onClick:e[0]||(e[0]=l=>R())})):r("",!0)]),s(Z,null,{content:_(()=>[t("div",ve,[k(c).isAdmin?(n(),p("div",me,[e[13]||(e[13]=t("label",null,"Pengguna",-1)),s(h,{modelValue:v.value.user_id,"onUpdate:modelValue":e[1]||(e[1]=l=>v.value.user_id=l),options:[{id:null,name:"Semua Pengguna"},...$.value],optionLabel:"name",optionValue:"id",placeholder:"Semua Pengguna",onChange:b,filter:""},null,8,["modelValue","options"])])):r("",!0),t("div",ye,[e[14]||(e[14]=t("label",null,"Jenis Sholat",-1)),s(h,{modelValue:v.value.prayer_type,"onUpdate:modelValue":e[2]||(e[2]=l=>v.value.prayer_type=l),options:E,optionLabel:"label",optionValue:"value",placeholder:"Semua",onChange:b},null,8,["modelValue"])]),t("div",_e,[e[15]||(e[15]=t("label",null,"Tanggal Mulai",-1)),s(D,{modelValue:v.value.start_date,"onUpdate:modelValue":e[3]||(e[3]=l=>v.value.start_date=l),dateFormat:"yy-mm-dd",onDateSelect:b},null,8,["modelValue"])]),t("div",ge,[e[16]||(e[16]=t("label",null,"Tanggal Akhir",-1)),s(D,{modelValue:v.value.end_date,"onUpdate:modelValue":e[4]||(e[4]=l=>v.value.end_date=l),dateFormat:"yy-mm-dd",onDateSelect:b},null,8,["modelValue"])]),s(m,{label:"Hapus Filter",icon:"pi pi-filter-slash",onClick:G,severity:"secondary"})]),s(Q,{value:U.value,loading:A.value,class:"prayer-dataview"},{list:_(l=>[(n(!0),p(ie,null,re(l.items,u=>(n(),p("div",{class:"dataview-item",key:u.id},[t("div",fe,[e[18]||(e[18]=t("div",{class:"prayer-icon"},[t("i",{class:"pi pi-sun"})],-1)),t("div",be,[t("h3",he,d(H(u.prayer_type)),1),t("p",ke,[e[17]||(e[17]=t("i",{class:"pi pi-calendar"},null,-1)),F(" "+d(z(u.date)),1)])]),t("span",{class:S(I(u.status))},d(N(u.status)),3)]),t("div",Ve,[k(c).isAdmin?(n(),p("div",Ce,[e[20]||(e[20]=t("i",{class:"pi pi-user detail-icon"},null,-1)),t("div",Se,[e[19]||(e[19]=t("span",{class:"detail-label"},"Pengguna",-1)),t("span",we,d(u.user?.name),1)])])):r("",!0),u.notes?(n(),p("div",De,[e[22]||(e[22]=t("i",{class:"pi pi-comment detail-icon"},null,-1)),t("div",Te,[e[21]||(e[21]=t("span",{class:"detail-label"},"Catatan",-1)),t("span",Ae,d(u.notes),1)])])):r("",!0)]),k(c).isAdmin?(n(),p("div",Pe,[s(m,{icon:"pi pi-pencil",label:"Edit",onClick:te=>R(u),severity:"info",size:"small",outlined:""},null,8,["onClick"]),s(m,{icon:"pi pi-trash",label:"Hapus",onClick:te=>M(u),severity:"danger",size:"small",outlined:""},null,8,["onClick"])])):r("",!0)]))),128))]),empty:_(()=>[...e[23]||(e[23]=[t("div",{class:"empty-state"},[t("i",{class:"pi pi-inbox",style:{"font-size":"3rem",color:"#9ca3af"}}),t("p",null,"Tidak ada catatan sholat ditemukan")],-1)])]),_:1},8,["value","loading"]),s(W,{value:U.value,loading:A.value,responsiveLayout:"scroll",rows:f.value.per_page,class:"mt-4 desktop-table w-full"},{default:_(()=>[k(c).isAdmin?(n(),x(C,{key:0,field:"user.name",header:"Pengguna"})):r("",!0),s(C,{field:"date",header:"Tanggal"},{body:_(l=>[F(d(z(l.data.date)),1)]),_:1}),s(C,{field:"prayer_type",header:"Jenis Sholat"},{body:_(l=>[F(d(H(l.data.prayer_type)),1)]),_:1}),s(C,{field:"status",header:"Status"},{body:_(l=>[t("span",{class:S(I(l.data.status))},d(N(l.data.status)),3)]),_:1}),s(C,{field:"notes",header:"Catatan"},{body:_(l=>[F(d(l.data.notes||"-"),1)]),_:1}),k(c).isAdmin?(n(),x(C,{key:1,header:"Aksi"},{body:_(l=>[t("div",xe,[s(m,{icon:"pi pi-pencil",onClick:u=>R(l.data),severity:"info",text:"",rounded:""},null,8,["onClick"]),s(m,{icon:"pi pi-trash",onClick:u=>M(l.data),severity:"danger",text:"",rounded:""},null,8,["onClick"])])]),_:1})):r("",!0)]),_:1},8,["value","loading","rows"]),f.value.total>0?(n(),x(X,{key:0,rows:f.value.per_page,totalRecords:f.value.total,first:(f.value.current_page-1)*f.value.per_page,onPage:K,class:"mt-4"},null,8,["rows","totalRecords","first"])):r("",!0)]),_:1}),s(ae,{visible:w.value,"onUpdate:visible":e[11]||(e[11]=l=>w.value=l),header:P.value==="create"?"Tambah Catatan Sholat":"Edit Catatan Sholat",modal:!0,style:{width:"500px"}},{default:_(()=>[t("form",{onSubmit:de(O,["prevent"]),class:"dialog-form"},[k(c).isAdmin?(n(),p("div",Fe,[e[24]||(e[24]=t("label",{for:"user_id"},"Pengguna *",-1)),s(h,{id:"user_id",modelValue:o.value.user_id,"onUpdate:modelValue":e[5]||(e[5]=l=>o.value.user_id=l),options:$.value,optionLabel:"name",optionValue:"id",placeholder:"Pilih pengguna",class:S({"p-invalid":i.value.user_id}),filter:""},null,8,["modelValue","options","class"]),i.value.user_id?(n(),p("small",Ue,d(i.value.user_id),1)):r("",!0)])):r("",!0),t("div",$e,[e[25]||(e[25]=t("label",{for:"prayer_type"},"Jenis Sholat *",-1)),s(h,{id:"prayer_type",modelValue:o.value.prayer_type,"onUpdate:modelValue":e[6]||(e[6]=l=>o.value.prayer_type=l),options:E.filter(l=>l.value),optionLabel:"label",optionValue:"value",placeholder:"Pilih jenis sholat",class:S({"p-invalid":i.value.prayer_type})},null,8,["modelValue","options","class"]),i.value.prayer_type?(n(),p("small",Le,d(i.value.prayer_type),1)):r("",!0)]),t("div",Re,[e[26]||(e[26]=t("label",{for:"date"},"Tanggal *",-1)),s(D,{id:"date",modelValue:o.value.date,"onUpdate:modelValue":e[7]||(e[7]=l=>o.value.date=l),dateFormat:"yy-mm-dd",class:S({"p-invalid":i.value.date})},null,8,["modelValue","class"]),i.value.date?(n(),p("small",Be,d(i.value.date),1)):r("",!0)]),t("div",Ee,[e[27]||(e[27]=t("label",{for:"status"},"Status *",-1)),s(h,{id:"status",modelValue:o.value.status,"onUpdate:modelValue":e[8]||(e[8]=l=>o.value.status=l),options:j,optionLabel:"label",optionValue:"value",placeholder:"Pilih status",class:S({"p-invalid":i.value.status})},null,8,["modelValue","class"]),i.value.status?(n(),p("small",Me,d(i.value.status),1)):r("",!0)]),t("div",ze,[e[28]||(e[28]=t("label",{for:"notes"},"Catatan",-1)),s(ee,{id:"notes",modelValue:o.value.notes,"onUpdate:modelValue":e[9]||(e[9]=l=>o.value.notes=l),rows:"3",placeholder:"Tambahkan catatan..."},null,8,["modelValue"])]),t("div",He,[s(m,{label:"Batal",onClick:e[10]||(e[10]=l=>w.value=!1),severity:"secondary",text:""}),s(m,{type:"submit",label:"Simpan",loading:L.value},null,8,["loading"])])],32)]),_:1},8,["visible","header"])])}}},qe=ue(Ne,[["__scopeId","data-v-8556488e"]]);export{qe as default};
