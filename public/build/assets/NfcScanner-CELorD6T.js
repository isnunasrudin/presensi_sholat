import{a as G,r,m as j,B as z,c,f as e,b as l,w as D,d as v,o as p,h as k,n as $,t as u,F as J,s as Y,p as I}from"./app-BAyi6xf7.js";import{_ as q}from"./_plugin-vue_export-helper-DlAUqK2U.js";const O={class:"nfc-scanner"},Q={class:"selection-form"},W={class:"field"},X={class:"field"},Z={class:"field"},aa={key:0,class:"scan-status"},ea={key:1,class:"detected-card"},ta={class:"card-info"},sa={class:"card-details"},na={class:"card-url"},la={key:2,class:"user-info"},oa={class:"user-card"},ia={class:"user-details"},ra={class:"action-buttons"},ua={key:3,class:"scan-history"},da={class:"history-content"},ca={class:"history-user"},pa={class:"history-time"},ma={class:"confirmation-content"},va={__name:"NfcScanner",setup(ga){const i=G(),d=r(!1),g=r(new Date),h=r(null),y=r(null),o=r(null),m=r(!1),_=r(""),S=r([]),T=[{label:"Dhuhur",value:"dhuhur"},{label:"Dhuha",value:"dhuha"}];let x=null;const B=()=>{d.value?E():L()},L=()=>{if(!g.value||!h.value){i.add({severity:"warn",summary:"Peringatan",detail:"Harap pilih tanggal dan jenis sholat terlebih dahulu",life:3e3});return}d.value=!0,i.add({severity:"info",summary:"Scan Dimulai",detail:"Menunggu kartu NFC...",life:3e3}),M()},E=()=>{d.value=!1,clearInterval(x),y.value=null,o.value=null,i.add({severity:"info",summary:"Scan Dihentikan",detail:"Scan NFC telah dihentikan",life:3e3})},M=async()=>{if(!("NDEFReader"in window)){i.add({severity:"warn",summary:"Peringatan",detail:"NFC tidak didukung di browser ini",life:5e3});return}try{const t=new NDEFReader;await t.scan(),t.addEventListener("reading",({message:a,serialNumber:b})=>{if(a.records.length>0){const f=a.records[0],n=new TextDecoder().decode(f.data);y.value={url:n,timestamp:new Date};const C=n.split("/").pop();P(C)}})}catch(t){i.add({severity:"error",summary:"Error",detail:"Gagal membaca NFC: "+t.message,life:3e3})}},P=async t=>{try{const a=await I.get(`/users/${t}`);o.value=a.data.data||a.data,_.value=o.value.name,m.value=!0}catch{i.add({severity:"error",summary:"Error",detail:"Gagal mengambil informasi pengguna",life:3e3})}},N=t=>{m.value=!0},F=async t=>{try{m.value=!1;const a=await I.post("/prayer-records",{user_id:o.value.id,prayer_type:h.value,date:U(g.value),status:t,notes:`Dicatat melalui scan NFC pada ${new Date().toLocaleString("id-ID")}`});S.value.unshift({userName:o.value.name,status:t,statusLabel:V(t),time:new Date().toLocaleTimeString()}),y.value=null,o.value=null,i.add({severity:"success",summary:"Berhasil",detail:`Kehadiran ${o.value?.name||"pengguna"} telah dicatat sebagai ${V(t)}`,life:3e3})}catch(a){i.add({severity:"error",summary:"Error",detail:"Gagal mencatat kehadiran: "+(a.response?.data?.message||a.message),life:3e3})}},U=t=>{if(!t)return null;const a=new Date(t),b=a.getFullYear(),f=String(a.getMonth()+1).padStart(2,"0"),n=String(a.getDate()).padStart(2,"0");return`${b}-${f}-${n}`},V=t=>{switch(t){case"sholat":return"Sholat";case"tidak_sholat":return"Tidak Sholat";case"halangan":return"Halangan";default:return t}},K=t=>t.toLocaleDateString("id-ID",{day:"numeric",month:"long",year:"numeric"});return j(()=>{"NDEFReader"in window?console.log("NFC is supported"):(console.log("NFC is not supported in this browser"),i.add({severity:"warn",summary:"Peringatan",detail:"NFC tidak didukung di browser ini. Menggunakan simulasi.",life:5e3}))}),z(()=>{}),(t,a)=>{const b=v("Calendar"),f=v("Dropdown"),n=v("Button"),C=v("DataView"),A=v("Card"),H=v("Dialog");return p(),c("div",O,[a[20]||(a[20]=e("div",{class:"page-header"},[e("h1",{class:"page-title"},"Scan NFC Kehadiran Sholat")],-1)),l(A,null,{content:D(()=>[e("div",Q,[e("div",W,[a[8]||(a[8]=e("label",{for:"prayerDate"},"Tanggal Sholat",-1)),l(b,{id:"prayerDate",modelValue:g.value,"onUpdate:modelValue":a[0]||(a[0]=s=>g.value=s),dateFormat:"yy-mm-dd",showIcon:!0,maxDate:new Date},null,8,["modelValue","maxDate"])]),e("div",X,[a[9]||(a[9]=e("label",{for:"prayerType"},"Jenis Sholat",-1)),l(f,{id:"prayerType",modelValue:h.value,"onUpdate:modelValue":a[1]||(a[1]=s=>h.value=s),options:T,optionLabel:"label",optionValue:"value",placeholder:"Pilih jenis sholat"},null,8,["modelValue"])]),e("div",Z,[a[10]||(a[10]=e("label",null,"Â ",-1)),l(n,{label:d.value?"Hentikan Scan":"Mulai Scan",icon:d.value?"pi pi-stop":"pi pi-play",onClick:B,class:$(d.value?"p-button-danger":"p-button-success")},null,8,["label","icon","class"])])]),d.value?(p(),c("div",aa,[...a[11]||(a[11]=[e("div",{class:"status-indicator"},[e("i",{class:"pi pi-wifi status-icon"}),e("span",null,"Menunggu kartu NFC...")],-1)])])):k("",!0),y.value?(p(),c("div",ea,[a[14]||(a[14]=e("h3",null,"Kartu Terdeteksi",-1)),e("div",ta,[a[13]||(a[13]=e("i",{class:"pi pi-user card-icon"},null,-1)),e("div",sa,[e("p",na,u(y.value.url),1),a[12]||(a[12]=e("p",{class:"card-status"},"Memproses data pengguna...",-1))])])])):k("",!0),o.value?(p(),c("div",la,[a[16]||(a[16]=e("h3",null,"Informasi Pengguna",-1)),e("div",oa,[a[15]||(a[15]=e("div",{class:"user-avatar"},[e("i",{class:"pi pi-user"})],-1)),e("div",ia,[e("h4",null,u(o.value.name),1),e("p",null,u(o.value.email),1)])]),e("div",ra,[l(n,{label:"Sholat",icon:"pi pi-check",onClick:a[2]||(a[2]=s=>N("sholat")),class:"p-button-success"}),l(n,{label:"Berhalangan",icon:"pi pi-times",onClick:a[3]||(a[3]=s=>N("halangan")),class:"p-button-warning"})])])):k("",!0),S.value.length>0?(p(),c("div",ua,[a[18]||(a[18]=e("h3",null,"Riwayat Scan Terbaru",-1)),l(C,{value:S.value,paginator:!0,rows:5},{list:D(s=>[(p(!0),c(J,null,Y(s.items,(w,R)=>(p(),c("div",{class:"history-item",key:R},[e("div",da,[e("div",ca,[a[17]||(a[17]=e("i",{class:"pi pi-user"},null,-1)),e("span",null,u(w.userName),1)]),e("div",{class:$(["history-status",w.status])},u(w.statusLabel),3),e("div",pa,u(w.time),1)])]))),128))]),_:1},8,["value"])])):k("",!0)]),_:1}),l(H,{visible:m.value,"onUpdate:visible":a[7]||(a[7]=s=>m.value=s),style:{width:"450px"},header:"Konfirmasi Kehadiran",modal:!0},{footer:D(()=>[l(n,{label:"Batal",icon:"pi pi-times",onClick:a[4]||(a[4]=s=>m.value=!1),class:"p-button-text"}),l(n,{label:"Berhalangan",icon:"pi pi-times",onClick:a[5]||(a[5]=s=>F("halangan")),class:"p-button-warning"}),l(n,{label:"Sholat",icon:"pi pi-check",onClick:a[6]||(a[6]=s=>F("sholat")),class:"p-button-success"})]),default:D(()=>[e("div",ma,[a[19]||(a[19]=e("i",{class:"pi pi-exclamation-triangle"},null,-1)),e("span",null,"Apakah "+u(_.value)+" melakukan sholat pada "+u(K(g.value))+"?",1)])]),_:1},8,["visible"])])}}},ha=q(va,[["__scopeId","data-v-c6e4b69d"]]);export{ha as default};
