import{r as s,o as Ta,c as p,e as l,y as t,j as w,q as m,k as Sa,d as r,p as O,s as C,R as Ua,F as ta,A as sa,t as d,h as oa,l as N,D as Aa,v as F}from"./vue-Bki0M6Jk.js";import{u as Pa,p as La,o as Ea}from"./primevue-DK4246gS.js";import{a as b}from"./app-Brb7QJ--.js";import{_ as Ka}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Na={class:"rombongan-belajar"},Fa={class:"page-header"},Xa={class:"header-actions"},qa={class:"filters"},za={class:"filter-group"},Ma={class:"rombongan-info"},Ga={class:"rombongan-main"},Ha={class:"rombongan-name"},Oa={class:"rombongan-details"},Ja={class:"detail-badge"},Qa={class:"detail-year"},Ya={class:"rombongan-stats"},Wa={class:"stat-item"},Za={class:"item-actions"},ae={class:"action-buttons"},ee={class:"field"},le={key:0,class:"p-error"},ne={class:"field"},te={key:0,class:"p-error"},se={class:"field"},oe={key:0,class:"p-error"},ie={class:"dialog-actions"},re={class:"dialog-form"},ue={class:"field"},de={key:0,class:"promotion-preview"},ce={class:"preview-card"},me={class:"preview-list"},ve={class:"rombel-name"},ge={class:"tingkat-change"},pe={class:"tingkat current"},be={class:"tingkat next"},ke={class:"dialog-actions"},he={class:"dialog-form"},fe={class:"field"},ye={class:"dialog-actions"},_e={key:0},we={class:"users-dialog-header"},Ce={class:"search-section"},Ie={class:"actions-section"},Ve={key:0,class:"selection-info"},je={key:1,class:"empty-state"},$e={__name:"RombonganBelajar",setup(De){const i=Pa(),j=La(),S=s([]),U=s(!1),X=s(!1),$=s(!1),A=s("create"),q=s(!1),D=s(null),B=s([]),V=s([]),c=s([]),P=s(""),v=s({}),x=s(!1),R=s(!1),f=s(null),I=s(null),z=s(!1),M=s(!1),J=s([]),G=s(!1),k=s([]),ia={X:"XI",XI:"XII",10:"11",11:"12",7:"8",8:"9",VII:"VIII",VIII:"IX",1:"2",2:"3",3:"4",4:"5",5:"6",6:"7",I:"II",II:"III",III:"IV",IV:"V",V:"VI",VI:"VII"},ra=s(["XII","12","IX","9","VI","6"]),L=s({search:""}),_=s({current_page:1,per_page:15,total:0}),g=s({id:null,nama_rombel:"",tingkat:"",tahun_angkatan:null});let Q=null;const ua=()=>{clearTimeout(Q),Q=setTimeout(()=>{y()},500)},y=async()=>{U.value=!0;try{const e={page:_.value.current_page,...L.value},a=await b.get("/rombongan-belajar",{params:e});S.value=a.data.data,_.value={current_page:a.data.current_page,per_page:a.data.per_page,total:a.data.total}}catch{i.add({severity:"error",summary:"Error",detail:"Failed to fetch rombongan belajar",life:3e3})}finally{U.value=!1}},H=(e=null)=>{v.value={},e?(A.value="edit",g.value={id:e.id,nama_rombel:e.nama_rombel,tingkat:e.tingkat,tahun_angkatan:e.tahun_angkatan}):(A.value="create",g.value={id:null,nama_rombel:"",tingkat:"",tahun_angkatan:null}),$.value=!0},da=async()=>{v.value={},X.value=!0;try{const e={nama_rombel:g.value.nama_rombel,tingkat:g.value.tingkat,tahun_angkatan:g.value.tahun_angkatan};A.value==="edit"?(await b.put(`/rombongan-belajar/${g.value.id}`,e),i.add({severity:"success",summary:"Success",detail:"Rombongan Belajar updated successfully",life:3e3})):(await b.post("/rombongan-belajar",e),i.add({severity:"success",summary:"Success",detail:"Rombongan Belajar created successfully",life:3e3})),$.value=!1,y()}catch(e){e.response?.data?.errors?v.value=e.response.data.errors:i.add({severity:"error",summary:"Error",detail:e.response?.data?.message||"Failed to save rombongan belajar",life:3e3})}finally{X.value=!1}},Y=e=>{j.require({message:`Are you sure you want to delete "${e.nama_rombel}"?`,header:"Confirm Delete",icon:"pi pi-exclamation-triangle",accept:()=>ca(e.id)})},ca=async e=>{try{await b.delete(`/rombongan-belajar/${e}`),i.add({severity:"success",summary:"Success",detail:"Rombongan Belajar deleted successfully",life:3e3}),y()}catch(a){i.add({severity:"error",summary:"Error",detail:a.response?.data?.message||"Failed to delete rombongan belajar",life:3e3})}},W=async e=>{D.value=e,c.value=[],P.value="";try{const a=await b.get(`/rombongan-belajar/${e.id}`);B.value=a.data.users||[],V.value=[...B.value],q.value=!0}catch{i.add({severity:"error",summary:"Error",detail:"Failed to fetch users",life:3e3})}},ma=()=>{L.value={search:""},y()},va=e=>{_.value.current_page=e.page+1,y()},ga=e=>e.charAt(0).toUpperCase()+e.slice(1),pa=e=>e==="admin"?"role-badge admin":"role-badge user",Z=()=>{const e=P.value.toLowerCase();V.value=B.value.filter(a=>a.name.toLowerCase().includes(e)||a.email.toLowerCase().includes(e)||a.role.toLowerCase().includes(e))},ba=e=>{c.value=e},ka=()=>{c.value=[...V.value]},ha=()=>{c.value=[]},fa=e=>{j.require({message:`Detach "${e.name}" dari rombongan "${D.value.nama_rombel}"?`,header:"Konfirmasi Detach",icon:"pi pi-exclamation-triangle",accept:()=>_a(e.id)})},ya=()=>{j.require({message:`Detach ${c.value.length} siswa terpilih dari rombongan "${D.value.nama_rombel}"?`,header:"Konfirmasi Bulk Detach",icon:"pi pi-exclamation-triangle",accept:()=>wa()})},_a=async e=>{try{await b.put(`/users/${e}`,{rombongan_belajar_id:null}),i.add({severity:"success",summary:"Success",detail:"User berhasil di-detach dari rombongan",life:3e3}),await aa()}catch(a){i.add({severity:"error",summary:"Error",detail:a.response?.data?.message||"Failed to detach user",life:3e3})}},wa=async()=>{try{const e=c.value.map(a=>b.put(`/users/${a.id}`,{rombongan_belajar_id:null}));await Promise.all(e),i.add({severity:"success",summary:"Success",detail:`${c.value.length} siswa berhasil di-detach`,life:3e3}),c.value=[],await aa()}catch{i.add({severity:"error",summary:"Error",detail:"Failed to detach some users",life:3e3})}},aa=async()=>{try{const e=await b.get(`/rombongan-belajar/${D.value.id}`);B.value=e.data.users||[],Z(),y()}catch(e){console.error("Failed to refresh users list:",e)}},Ca=async()=>{f.value=null,k.value=[],x.value=!0,G.value=!0;try{const e=await b.get("/rombongan-belajar-tahun-angkatan");J.value=e.data}catch{i.add({severity:"error",summary:"Error",detail:"Failed to fetch tahun angkatan",life:3e3})}finally{G.value=!1}},Ia=async()=>{if(!f.value){k.value=[];return}const e=S.value.filter(a=>a.tahun_angkatan==f.value);k.value=e.map(a=>({nama_rombel:a.nama_rombel,tingkat:a.tingkat,next_tingkat:ia[a.tingkat]||a.tingkat}))},Va=()=>{k.value.length>0&&`${k.value.length}`,j.require({message:`Apakah Anda yakin ingin menaikkan semua rombongan belajar angkatan ${f.value} ke tingkat berikutnya? Total ${k.value.length} rombongan akan dinaikkan.`,header:"Konfirmasi Naik Kelas",icon:"pi pi-question-circle",accept:()=>ja()})},ja=async()=>{z.value=!0;try{const e=await b.post(`/rombongan-belajar/promote/${f.value}`);i.add({severity:"success",summary:"Berhasil",detail:e.data.message,life:5e3}),x.value=!1,f.value=null,k.value=[],y()}catch(e){i.add({severity:"error",summary:"Error",detail:e.response?.data?.message||"Gagal menaikkan kelas rombongan belajar",life:3e3})}finally{z.value=!1}},$a=()=>{I.value=null,R.value=!0},Da=()=>{j.require({message:`PERINGATAN: Tindakan ini akan meluluskan semua siswa pada tingkat ${I.value}. Siswa akan di-detach dari rombongan dan semua rombongan belajar tingkat ${I.value} akan dihapus. Apakah Anda yakin?`,header:"Konfirmasi Kelulusan",icon:"pi pi-exclamation-triangle",acceptLabel:"Ya, Luluskan",rejectLabel:"Batal",acceptClass:"p-button-danger",accept:()=>Ba()})},Ba=async()=>{M.value=!0;try{const e=await b.post(`/rombongan-belajar/graduate/${I.value}`);i.add({severity:"success",summary:"Berhasil",detail:e.data.message,life:5e3}),R.value=!1,y()}catch(e){i.add({severity:"error",summary:"Error",detail:e.response?.data?.message||"Gagal meluluskan rombongan belajar",life:3e3})}finally{M.value=!1}};return Ta(()=>{y()}),(e,a)=>{const o=w("Button"),T=w("InputText"),h=w("Column"),ea=w("DataTable"),xa=w("Paginator"),Ra=w("Card"),E=w("Dialog"),la=w("Dropdown"),K=Sa("tooltip");return r(),p("div",Na,[l("div",Fa,[a[17]||(a[17]=l("h1",{class:"page-title"},"Manajemen Rombongan Belajar",-1)),l("div",Xa,[t(o,{label:"Naik Kelas",icon:"pi pi-arrow-up",onClick:a[0]||(a[0]=n=>Ca()),severity:"info"}),t(o,{label:"Kelulusan",icon:"pi pi-graduation-cap",onClick:a[1]||(a[1]=n=>$a()),severity:"success"}),t(o,{label:"Tambah Rombongan",icon:"pi pi-plus",onClick:a[2]||(a[2]=n=>H())})])]),t(Ra,null,{content:m(()=>[l("div",qa,[l("div",za,[a[18]||(a[18]=l("label",null,"Cari",-1)),t(T,{modelValue:L.value.search,"onUpdate:modelValue":a[3]||(a[3]=n=>L.value.search=n),placeholder:"Cari berdasarkan nama rombel atau tingkat",onInput:ua},null,8,["modelValue"])]),t(o,{label:"Hapus Filter",icon:"pi pi-filter-slash",onClick:ma,severity:"secondary"})]),t(Ua(Ea),{value:S.value,loading:U.value,class:"rombongan-dataview"},{list:m(n=>[(r(!0),p(ta,null,sa(n.items,u=>(r(),p("div",{class:"dataview-item",key:u.id},[l("div",Ma,[l("div",Ga,[l("h3",Ha,d(u.nama_rombel),1),l("p",Oa,[l("span",Ja,d(u.tingkat),1),l("span",Qa,"Angkatan "+d(u.tahun_angkatan),1)])]),l("div",Ya,[l("div",Wa,[a[19]||(a[19]=l("i",{class:"pi pi-users"},null,-1)),l("span",null,d(u.users_count)+" Siswa",1)])])]),l("div",Za,[t(o,{icon:"pi pi-eye",label:"Lihat Siswa",onClick:na=>W(u),severity:"info",size:"small",outlined:"",class:"w-full"},null,8,["onClick"]),t(o,{icon:"pi pi-pencil",label:"Edit",onClick:na=>H(u),severity:"success",size:"small",outlined:""},null,8,["onClick"]),t(o,{icon:"pi pi-trash",label:"Hapus",onClick:na=>Y(u),severity:"danger",size:"small",outlined:""},null,8,["onClick"])])]))),128))]),empty:m(()=>[...a[20]||(a[20]=[l("div",{class:"empty-state"},[l("i",{class:"pi pi-graduation-cap",style:{"font-size":"3rem",color:"#9ca3af"}}),l("p",null,"Tidak ada rombongan belajar ditemukan")],-1)])]),_:1},8,["value","loading"]),t(ea,{value:S.value,loading:U.value,responsiveLayout:"scroll",class:"mt-4 desktop-table w-full"},{default:m(()=>[t(h,{field:"nama_rombel",header:"Nama Rombel"}),t(h,{field:"tingkat",header:"Tingkat"}),t(h,{field:"tahun_angkatan",header:"Tahun Angkatan"}),t(h,{header:"Jumlah Siswa"},{body:m(n=>[oa(d(n.data.users_count),1)]),_:1}),t(h,{header:"Aksi"},{body:m(n=>[l("div",ae,[N(t(o,{icon:"pi pi-eye",onClick:u=>W(n.data),severity:"info",text:"",rounded:""},null,8,["onClick"]),[[K,"Lihat Siswa",void 0,{top:!0}]]),N(t(o,{icon:"pi pi-pencil",onClick:u=>H(n.data),severity:"success",text:"",rounded:""},null,8,["onClick"]),[[K,"Edit",void 0,{top:!0}]]),N(t(o,{icon:"pi pi-trash",onClick:u=>Y(n.data),severity:"danger",text:"",rounded:""},null,8,["onClick"]),[[K,"Hapus",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","loading"]),_.value.total>0?(r(),O(xa,{key:0,rows:_.value.per_page,totalRecords:_.value.total,first:(_.value.current_page-1)*_.value.per_page,onPage:va,class:"mt-4"},null,8,["rows","totalRecords","first"])):C("",!0)]),_:1}),t(E,{visible:$.value,"onUpdate:visible":a[8]||(a[8]=n=>$.value=n),header:A.value==="create"?"Tambah Rombongan Belajar":"Edit Rombongan Belajar",modal:!0,style:{width:"500px"}},{default:m(()=>[l("form",{onSubmit:Aa(da,["prevent"]),class:"dialog-form"},[l("div",ee,[a[21]||(a[21]=l("label",{for:"nama_rombel"},"Nama Rombel *",-1)),t(T,{id:"nama_rombel",modelValue:g.value.nama_rombel,"onUpdate:modelValue":a[4]||(a[4]=n=>g.value.nama_rombel=n),placeholder:"Masukkan nama rombel",class:F({"p-invalid":v.value.nama_rombel})},null,8,["modelValue","class"]),v.value.nama_rombel?(r(),p("small",le,d(v.value.nama_rombel),1)):C("",!0)]),l("div",ne,[a[22]||(a[22]=l("label",{for:"tingkat"},"Tingkat *",-1)),t(T,{id:"tingkat",modelValue:g.value.tingkat,"onUpdate:modelValue":a[5]||(a[5]=n=>g.value.tingkat=n),placeholder:"Contoh: X, XI, XII",class:F({"p-invalid":v.value.tingkat})},null,8,["modelValue","class"]),v.value.tingkat?(r(),p("small",te,d(v.value.tingkat),1)):C("",!0)]),l("div",se,[a[23]||(a[23]=l("label",{for:"tahun_angkatan"},"Tahun Angkatan *",-1)),t(T,{id:"tahun_angkatan",modelValue:g.value.tahun_angkatan,"onUpdate:modelValue":a[6]||(a[6]=n=>g.value.tahun_angkatan=n),placeholder:"Contoh: 2023",class:F({"p-invalid":v.value.tahun_angkatan})},null,8,["modelValue","class"]),v.value.tahun_angkatan?(r(),p("small",oe,d(v.value.tahun_angkatan),1)):C("",!0)]),l("div",ie,[t(o,{label:"Batal",onClick:a[7]||(a[7]=n=>$.value=!1),severity:"secondary",text:""}),t(o,{type:"submit",label:"Simpan",loading:X.value},null,8,["loading"])])],32)]),_:1},8,["visible","header"]),t(E,{visible:x.value,"onUpdate:visible":a[11]||(a[11]=n=>x.value=n),header:"Naik Kelas Rombongan Belajar",modal:!0,style:{width:"600px"}},{default:m(()=>[l("div",re,[a[26]||(a[26]=l("div",{class:"info-message"},[l("i",{class:"pi pi-info-circle"}),l("p",null,"Pilih tahun angkatan yang akan dinaikkan. Semua rombongan belajar dalam angkatan tersebut akan naik ke tingkat berikutnya secara otomatis.")],-1)),l("div",ue,[a[24]||(a[24]=l("label",{for:"promote_tahun_angkatan"},"Pilih Tahun Angkatan *",-1)),t(la,{id:"promote_tahun_angkatan",modelValue:f.value,"onUpdate:modelValue":a[9]||(a[9]=n=>f.value=n),options:J.value,placeholder:"Pilih tahun angkatan",loading:G.value,class:"w-full",onChange:Ia},null,8,["modelValue","options","loading"])]),k.value.length>0?(r(),p("div",de,[l("div",ce,[l("h4",null,"Preview Kenaikan Kelas ("+d(k.value.length)+" Rombongan)",1),l("div",me,[(r(!0),p(ta,null,sa(k.value,(n,u)=>(r(),p("div",{key:u,class:"preview-list-item"},[l("span",ve,d(n.nama_rombel),1),l("div",ge,[l("span",pe,d(n.tingkat),1),a[25]||(a[25]=l("i",{class:"pi pi-arrow-right"},null,-1)),l("span",be,d(n.next_tingkat),1)])]))),128))])])])):C("",!0),l("div",ke,[t(o,{label:"Batal",onClick:a[10]||(a[10]=n=>x.value=!1),severity:"secondary",text:""}),t(o,{label:"Naikkan Kelas",icon:"pi pi-arrow-up",onClick:Va,disabled:!f.value,loading:z.value},null,8,["disabled","loading"])])])]),_:1},8,["visible"]),t(E,{visible:R.value,"onUpdate:visible":a[14]||(a[14]=n=>R.value=n),header:"Kelulusan Rombongan Belajar",modal:!0,style:{width:"500px"}},{default:m(()=>[l("div",he,[a[28]||(a[28]=l("div",{class:"warning-message"},[l("i",{class:"pi pi-exclamation-triangle"}),l("p",null,[l("strong",null,"Perhatian:"),oa(" Tindakan ini akan meluluskan semua siswa pada tingkat terpilih. Siswa akan di-detach dari rombongan dan rombongan belajar akan dihapus.")])],-1)),l("div",fe,[a[27]||(a[27]=l("label",{for:"graduate_tingkat"},"Pilih Tingkat yang Akan Lulus *",-1)),t(la,{id:"graduate_tingkat",modelValue:I.value,"onUpdate:modelValue":a[12]||(a[12]=n=>I.value=n),options:ra.value,placeholder:"Pilih tingkat",class:"w-full"},null,8,["modelValue","options"])]),l("div",ye,[t(o,{label:"Batal",onClick:a[13]||(a[13]=n=>R.value=!1),severity:"secondary",text:""}),t(o,{label:"Luluskan",icon:"pi pi-graduation-cap",onClick:Da,disabled:!I.value,loading:M.value,severity:"danger"},null,8,["disabled","loading"])])])]),_:1},8,["visible"]),t(E,{visible:q.value,"onUpdate:visible":a[16]||(a[16]=n=>q.value=n),header:`Siswa di ${D.value?.nama_rombel||""}`,modal:!0,style:{width:"900px"}},{default:m(()=>[B.value.length>0?(r(),p("div",_e,[l("div",we,[l("div",Ce,[t(T,{modelValue:P.value,"onUpdate:modelValue":a[15]||(a[15]=n=>P.value=n),placeholder:"Cari siswa...",onInput:Z,class:"search-input"},null,8,["modelValue"]),a[29]||(a[29]=l("i",{class:"pi pi-search search-icon"},null,-1))]),l("div",Ie,[c.value.length>0?(r(),O(o,{key:0,label:"Detach Terpilih",icon:"pi pi-times",onClick:ya,severity:"danger",size:"small"})):C("",!0),t(o,{label:"Pilih Semua",icon:"pi pi-check-square",onClick:ka,severity:"info",size:"small",outlined:"",disabled:V.value.length===0},null,8,["disabled"]),c.value.length>0?(r(),O(o,{key:1,label:"Batal Pilih",icon:"pi pi-times-circle",onClick:ha,severity:"secondary",size:"small",text:""})):C("",!0)])]),t(ea,{value:V.value,selection:c.value,onSelectionChange:ba,selectionMode:"multiple",class:"w-full users-table",paginator:V.value.length>10,rows:10},{default:m(()=>[t(h,{selectionMode:"multiple",headerStyle:"width: 3rem"}),t(h,{field:"name",header:"Nama",sortable:""}),t(h,{field:"email",header:"Email",sortable:""}),t(h,{field:"role",header:"Peran",sortable:""},{body:m(n=>[l("span",{class:F(pa(n.data.role))},d(ga(n.data.role)),3)]),_:1}),t(h,{header:"Aksi"},{body:m(n=>[N(t(o,{icon:"pi pi-times",onClick:u=>fa(n.data),severity:"danger",text:"",rounded:""},null,8,["onClick"]),[[K,"Detach dari rombongan",void 0,{top:!0}]])]),_:1})]),_:1},8,["value","selection","paginator"]),c.value.length>0?(r(),p("div",Ve,[a[30]||(a[30]=l("i",{class:"pi pi-info-circle"},null,-1)),l("span",null,d(c.value.length)+" siswa dipilih",1)])):C("",!0)])):(r(),p("div",je,[...a[31]||(a[31]=[l("i",{class:"pi pi-users",style:{"font-size":"2rem",color:"#9ca3af"}},null,-1),l("p",null,"Belum ada siswa di rombongan ini",-1)])]))]),_:1},8,["visible","header"])])}}},Se=Ka($e,[["__scopeId","data-v-a8599fd7"]]);export{Se as default};
