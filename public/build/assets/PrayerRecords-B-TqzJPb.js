import{r as m,o as te,c,e as s,y as l,p as L,s as u,R as A,q as h,j as v,k as se,d as n,t as i,v as k,h as N,l as z,D as le}from"./vue-Bki0M6Jk.js";import{u as oe,a as V}from"./app-Brb7QJ--.js";import{u as re,p as ne}from"./primevue-DK4246gS.js";import{_ as de}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ue={class:"prayer-records"},ie={class:"page-header"},ce={class:"filters"},me={class:"filter-group"},pe={key:0,class:"filter-group"},he={class:"filter-group"},ve={class:"user-info"},_e={class:"user-name"},ye={class:"user-email"},be={class:"rombel-badge"},fe={class:"prayer-column"},ge={key:0,class:"notes-text"},De={class:"prayer-column"},ke={key:0,class:"notes-text"},Ve={class:"combined-notes"},Ce={key:0,class:"note-item"},Se={key:1,class:"note-item"},we={key:2,class:"no-notes"},xe={class:"delete-actions"},Re={key:0,class:"empty-state"},Ae={key:0,class:"field"},Te={key:0,class:"p-error"},$e={class:"field"},je={key:0,class:"p-error"},Ue={class:"field"},Be={key:0,class:"p-error"},Fe={class:"field"},He={key:0,class:"p-error"},Ee={class:"field"},Ie={class:"dialog-actions"},Le={__name:"PrayerRecords",setup(Ne){const p=oe(),b=re(),M=ne(),S=m([]),T=m([]),U=m([]),w=m(!1),$=m(!1),C=m(!1),x=m("create"),r=m({}),_=m(new Date),R=m({rombongan_belajar_id:null}),K=[{label:"Dhuhur",value:"dhuhur"},{label:"Dhuha",value:"dhuha"}],q=[{label:"Sholat",value:"sholat"},{label:"Tidak Sholat",value:"tidak_sholat"},{label:"Halangan",value:"halangan"}],o=m({id:null,user_id:null,prayer_type:null,date:new Date,status:null,notes:""}),O=async()=>{if(p.isAdmin)try{const a=await V.get("/users");T.value=a.data.data||a.data}catch(a){console.error("Failed to fetch users:",a)}},G=async()=>{if(p.isAdmin)try{const a=await V.get("/rombongan-belajar");U.value=a.data.data||a.data}catch(a){console.error("Failed to fetch rombels:",a)}},f=async()=>{w.value=!0;try{const a={date:j(_.value)};R.value.rombongan_belajar_id&&(a.rombongan_belajar_id=R.value.rombongan_belajar_id);const e=await V.get("/prayer-records-daily-recap",{params:a});S.value=e.data}catch(a){console.error("Failed to fetch daily recap:",a),b.add({severity:"error",summary:"Error",detail:"Gagal mengambil data harian",life:3e3})}finally{w.value=!1}},J=(a=null)=>{r.value={},a?(x.value="edit",o.value={id:a.id,user_id:a.user_id,prayer_type:a.prayer_type,date:new Date(a.date),status:a.status,notes:a.notes||""}):(x.value="create",o.value={id:null,user_id:p.isAdmin?null:p.user.id,prayer_type:null,date:_.value,status:null,notes:""}),C.value=!0},Y=async()=>{r.value={},$.value=!0;try{const a={prayer_type:o.value.prayer_type,date:j(o.value.date),status:o.value.status,notes:o.value.notes};p.isAdmin&&(a.user_id=o.value.user_id),x.value==="edit"?(await V.put(`/prayer-records/${o.value.id}`,a),b.add({severity:"success",summary:"Success",detail:"Record updated successfully",life:3e3})):(await V.post("/prayer-records",a),b.add({severity:"success",summary:"Success",detail:"Record created successfully",life:3e3})),C.value=!1,f()}catch(a){a.response?.data?.errors?r.value=a.response.data.errors:b.add({severity:"error",summary:"Error",detail:a.response?.data?.message||"Failed to save record",life:3e3})}finally{$.value=!1}},B=(a,e)=>{if(!(e==="dhuha"?a.dhuha_record_id:a.dhuhur_record_id))return;const y=e==="dhuha"?"Dhuha":"Dhuhur";M.require({message:`Apakah Anda yakin ingin menghapus data sholat ${y} untuk ${a.name} pada ${F(_)}?`,header:"Konfirmasi Hapus",icon:"pi pi-exclamation-triangle",accept:()=>Q(a.user_id,j(_),e),reject:()=>{}})},Q=async(a,e,d)=>{try{await V.delete("/prayer-records-delete-by-user-date-type",{data:{user_id:a,date:e,prayer_type:d}}),b.add({severity:"success",summary:"Success",detail:`Data sholat ${d==="dhuha"?"Dhuha":"Dhuhur"} berhasil dihapus`,life:3e3}),f()}catch{b.add({severity:"error",summary:"Error",detail:"Failed to delete record",life:3e3})}},W=a=>T.value.find(d=>d.id===a)?.email||"",F=a=>new Date(a).toLocaleDateString("id-ID",{day:"numeric",month:"long",year:"numeric"}),j=a=>{if(!a)return null;const e=new Date(a),d=e.getFullYear(),y=String(e.getMonth()+1).padStart(2,"0"),g=String(e.getDate()).padStart(2,"0");return`${d}-${y}-${g}`},H=a=>({sholat:"prayer-badge success",tidak_sholat:"prayer-badge danger",halangan:"prayer-badge warning",null:"prayer-badge empty"})[a]||"prayer-badge empty",E=a=>({sholat:"OK",tidak_sholat:"-",halangan:"Halangan",null:"-"})[a]||"-";return te(()=>{f(),O(),G()}),(a,e)=>{const d=v("Button"),y=v("Calendar"),g=v("Dropdown"),D=v("Column"),X=v("DataTable"),Z=v("Card"),P=v("Textarea"),ee=v("Dialog"),I=se("tooltip");return n(),c("div",ue,[s("div",ie,[e[10]||(e[10]=s("h1",{class:"page-title"},"Catatan Sholat Harian",-1)),A(p).isAdmin?(n(),L(d,{key:0,label:"Tambah Catatan",icon:"pi pi-plus",onClick:e[0]||(e[0]=t=>J())})):u("",!0)]),l(Z,null,{content:h(()=>[s("div",ce,[s("div",me,[e[11]||(e[11]=s("label",null,"Tanggal",-1)),l(y,{modelValue:_.value,"onUpdate:modelValue":e[1]||(e[1]=t=>_.value=t),dateFormat:"yy-mm-dd",onDateSelect:f,showIcon:!0},null,8,["modelValue"])]),A(p).isAdmin?(n(),c("div",pe,[e[12]||(e[12]=s("label",null,"Rombel",-1)),l(g,{modelValue:R.value.rombongan_belajar_id,"onUpdate:modelValue":e[2]||(e[2]=t=>R.value.rombongan_belajar_id=t),options:[{id:null,nama_rombel:"Semua Rombel"},...U.value],optionLabel:"nama_rombel",optionValue:"id",placeholder:"Semua Rombel",onChange:f,filter:""},null,8,["modelValue","options"])])):u("",!0),s("div",he,[e[13]||(e[13]=s("label",null,"Â ",-1)),l(d,{label:"Refresh",icon:"pi pi-refresh",onClick:f,severity:"secondary"})])]),l(X,{value:S.value,loading:w.value,responsiveLayout:"scroll",class:"daily-recap-table mt-4",paginator:!0,rows:20,totalRecords:S.value.length,dataKey:"user_id"},{default:h(()=>[l(D,{field:"name",header:"Nama",sortable:""},{body:h(t=>[s("div",ve,[s("div",_e,i(t.data.name),1),s("div",ye,i(W(t.data.user_id)),1)])]),_:1}),l(D,{field:"rombel",header:"Rombel",sortable:""},{body:h(t=>[s("span",be,i(t.data.rombel),1)]),_:1}),l(D,{field:"dhuha_status",header:"Sholat Dhuha",sortable:""},{body:h(t=>[s("div",fe,[s("span",{class:k(H(t.data.dhuha_status))},i(E(t.data.dhuha_status)),3),t.data.dhuha_notes?(n(),c("small",ge,i(t.data.dhuha_notes),1)):u("",!0)])]),_:1}),l(D,{field:"dhuhur_status",header:"Sholat Dhuhur",sortable:""},{body:h(t=>[s("div",De,[s("span",{class:k(H(t.data.dhuhur_status))},i(E(t.data.dhuhur_status)),3),t.data.dhuhur_notes?(n(),c("small",ke,i(t.data.dhuhur_notes),1)):u("",!0)])]),_:1}),l(D,{header:"Catatan"},{body:h(t=>[s("div",Ve,[t.data.dhuha_notes?(n(),c("div",Ce,[e[14]||(e[14]=s("strong",null,"Dhuha:",-1)),N(" "+i(t.data.dhuha_notes),1)])):u("",!0),t.data.dhuhur_notes?(n(),c("div",Se,[e[15]||(e[15]=s("strong",null,"Dhuhur:",-1)),N(" "+i(t.data.dhuhur_notes),1)])):u("",!0),!t.data.dhuha_notes&&!t.data.dhuhur_notes?(n(),c("span",we," - ")):u("",!0)])]),_:1}),A(p).isAdmin?(n(),L(D,{key:0,header:"Hapus Data Rekap",style:{"min-width":"150px"}},{body:h(t=>[s("div",xe,[z(l(d,{icon:"pi pi-trash",label:"Hapus Dhuha",onClick:ae=>B(t.data,"dhuha"),severity:"warning",size:"small",text:"",disabled:!t.data.dhuha_record_id},null,8,["onClick","disabled"]),[[I,"Hapus data sholat Dhuha"]]),z(l(d,{icon:"pi pi-trash",label:"Hapus Dhuhur",onClick:ae=>B(t.data,"dhuhur"),severity:"danger",size:"small",text:"",disabled:!t.data.dhuhur_record_id},null,8,["onClick","disabled"]),[[I,"Hapus data sholat Dhuhur"]])])]),_:1})):u("",!0)]),_:1},8,["value","loading","totalRecords"]),!w.value&&S.value.length===0?(n(),c("div",Re,[e[16]||(e[16]=s("i",{class:"pi pi-inbox",style:{"font-size":"3rem",color:"#9ca3af"}},null,-1)),s("p",null,"Tidak ada data untuk tanggal "+i(F(_.value)),1)])):u("",!0)]),_:1}),l(ee,{visible:C.value,"onUpdate:visible":e[9]||(e[9]=t=>C.value=t),header:x.value==="create"?"Tambah Catatan Sholat":"Edit Catatan Sholat",modal:!0,style:{width:"500px"}},{default:h(()=>[s("form",{onSubmit:le(Y,["prevent"]),class:"dialog-form"},[A(p).isAdmin?(n(),c("div",Ae,[e[17]||(e[17]=s("label",{for:"user_id"},"Pengguna *",-1)),l(g,{id:"user_id",modelValue:o.value.user_id,"onUpdate:modelValue":e[3]||(e[3]=t=>o.value.user_id=t),options:T.value,optionLabel:"name",optionValue:"id",placeholder:"Pilih pengguna",class:k({"p-invalid":r.value.user_id}),filter:""},null,8,["modelValue","options","class"]),r.value.user_id?(n(),c("small",Te,i(r.value.user_id),1)):u("",!0)])):u("",!0),s("div",$e,[e[18]||(e[18]=s("label",{for:"prayer_type"},"Jenis Sholat *",-1)),l(g,{id:"prayer_type",modelValue:o.value.prayer_type,"onUpdate:modelValue":e[4]||(e[4]=t=>o.value.prayer_type=t),options:K.filter(t=>t.value),optionLabel:"label",optionValue:"value",placeholder:"Pilih jenis sholat",class:k({"p-invalid":r.value.prayer_type})},null,8,["modelValue","options","class"]),r.value.prayer_type?(n(),c("small",je,i(r.value.prayer_type),1)):u("",!0)]),s("div",Ue,[e[19]||(e[19]=s("label",{for:"date"},"Tanggal *",-1)),l(y,{id:"date",modelValue:o.value.date,"onUpdate:modelValue":e[5]||(e[5]=t=>o.value.date=t),dateFormat:"yy-mm-dd",class:k({"p-invalid":r.value.date})},null,8,["modelValue","class"]),r.value.date?(n(),c("small",Be,i(r.value.date),1)):u("",!0)]),s("div",Fe,[e[20]||(e[20]=s("label",{for:"status"},"Status *",-1)),l(g,{id:"status",modelValue:o.value.status,"onUpdate:modelValue":e[6]||(e[6]=t=>o.value.status=t),options:q,optionLabel:"label",optionValue:"value",placeholder:"Pilih status",class:k({"p-invalid":r.value.status})},null,8,["modelValue","class"]),r.value.status?(n(),c("small",He,i(r.value.status),1)):u("",!0)]),s("div",Ee,[e[21]||(e[21]=s("label",{for:"notes"},"Catatan",-1)),l(P,{id:"notes",modelValue:o.value.notes,"onUpdate:modelValue":e[7]||(e[7]=t=>o.value.notes=t),rows:"3",placeholder:"Tambahkan catatan..."},null,8,["modelValue"])]),s("div",Ie,[l(d,{label:"Batal",onClick:e[8]||(e[8]=t=>C.value=!1),severity:"secondary",text:""}),l(d,{type:"submit",label:"Simpan",loading:$.value},null,8,["loading"])])],32)]),_:1},8,["visible","header"])])}}},Oe=de(Le,[["__scopeId","data-v-f1327510"]]);export{Oe as default};
