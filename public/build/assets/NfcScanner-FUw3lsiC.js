import{a as G,r as i,m as R,B as z,c,f as e,b as n,w as k,d as g,o as p,h as D,n as I,t as r,F as J,s as Y,p as V}from"./app-DJIIXD6Q.js";import{_ as q}from"./_plugin-vue_export-helper-DlAUqK2U.js";const O={class:"nfc-scanner"},Q={class:"selection-form"},W={class:"field"},X={class:"field"},Z={class:"field"},aa={key:0,class:"scan-status"},ea={key:1,class:"detected-card"},ta={class:"card-info"},sa={class:"card-details"},na={class:"card-url"},la={key:2,class:"user-info"},oa={class:"user-card"},ia={class:"user-details"},ra={class:"action-buttons"},ua={key:3,class:"scan-history"},da={class:"history-content"},ca={class:"history-user"},pa={class:"history-time"},va={class:"confirmation-content"},ma={__name:"NfcScanner",setup(ga){const u=G(),d=i(!1),f=i(new Date),y=i(null),v=i(null),l=i(null),m=i(!1),C=i(""),S=i([]),B=[{label:"Dhuhur",value:"dhuhur"},{label:"Dhuha",value:"dhuha"}];let b=null;const M=()=>{d.value?x():T()},T=()=>{if(!f.value||!y.value){u.add({severity:"warn",summary:"Peringatan",detail:"Harap pilih tanggal dan jenis sholat terlebih dahulu",life:3e3});return}d.value=!0,u.add({severity:"info",summary:"Scan Dimulai",detail:"Menunggu kartu NFC...",life:3e3}),b=setInterval(()=>{Math.random()>.7&&!v.value&&L()},3e3)},x=()=>{d.value=!1,clearInterval(b),v.value=null,l.value=null,u.add({severity:"info",summary:"Scan Dihentikan",detail:"Scan NFC telah dihentikan",life:3e3})},L=()=>{const t=[`${window.location.origin}/u/1`,`${window.location.origin}/u/2`],a=t[Math.floor(Math.random()*t.length)];v.value={url:a,timestamp:new Date};const h=a.split("/").pop();U(h)},U=async t=>{try{const a=await V.get(`/users/${t}`);l.value=a.data.data||a.data,C.value=l.value.name,m.value=!0}catch{u.add({severity:"error",summary:"Error",detail:"Gagal mengambil informasi pengguna",life:3e3})}},N=t=>{m.value=!0},F=async t=>{try{m.value=!1;const a=await V.post("/prayer-records",{user_id:l.value.id,prayer_type:y.value,date:K(f.value),status:t,notes:`Dicatat melalui scan NFC pada ${new Date().toLocaleString("id-ID")}`});S.value.unshift({userName:l.value.name,status:t,statusLabel:$(t),time:new Date().toLocaleTimeString()}),v.value=null,l.value=null,u.add({severity:"success",summary:"Berhasil",detail:`Kehadiran ${l.value?.name||"pengguna"} telah dicatat sebagai ${$(t)}`,life:3e3})}catch(a){u.add({severity:"error",summary:"Error",detail:"Gagal mencatat kehadiran: "+(a.response?.data?.message||a.message),life:3e3})}},K=t=>{if(!t)return null;const a=new Date(t),h=a.getFullYear(),_=String(a.getMonth()+1).padStart(2,"0"),o=String(a.getDate()).padStart(2,"0");return`${h}-${_}-${o}`},$=t=>{switch(t){case"sholat":return"Sholat";case"tidak_sholat":return"Tidak Sholat";case"halangan":return"Halangan";default:return t}},P=t=>t.toLocaleDateString("id-ID",{day:"numeric",month:"long",year:"numeric"});return R(()=>{"NDEFReader"in window?console.log("NFC is supported"):(console.log("NFC is not supported in this browser"),u.add({severity:"warn",summary:"Peringatan",detail:"NFC tidak didukung di browser ini. Menggunakan simulasi.",life:5e3}))}),z(()=>{b&&clearInterval(b)}),(t,a)=>{const h=g("Calendar"),_=g("Dropdown"),o=g("Button"),A=g("DataView"),E=g("Card"),H=g("Dialog");return p(),c("div",O,[a[20]||(a[20]=e("div",{class:"page-header"},[e("h1",{class:"page-title"},"Scan NFC Kehadiran Sholat")],-1)),n(E,null,{content:k(()=>[e("div",Q,[e("div",W,[a[8]||(a[8]=e("label",{for:"prayerDate"},"Tanggal Sholat",-1)),n(h,{id:"prayerDate",modelValue:f.value,"onUpdate:modelValue":a[0]||(a[0]=s=>f.value=s),dateFormat:"yy-mm-dd",showIcon:!0,maxDate:new Date},null,8,["modelValue","maxDate"])]),e("div",X,[a[9]||(a[9]=e("label",{for:"prayerType"},"Jenis Sholat",-1)),n(_,{id:"prayerType",modelValue:y.value,"onUpdate:modelValue":a[1]||(a[1]=s=>y.value=s),options:B,optionLabel:"label",optionValue:"value",placeholder:"Pilih jenis sholat"},null,8,["modelValue"])]),e("div",Z,[a[10]||(a[10]=e("label",null,"Â ",-1)),n(o,{label:d.value?"Hentikan Scan":"Mulai Scan",icon:d.value?"pi pi-stop":"pi pi-play",onClick:M,class:I(d.value?"p-button-danger":"p-button-success")},null,8,["label","icon","class"])])]),d.value?(p(),c("div",aa,[...a[11]||(a[11]=[e("div",{class:"status-indicator"},[e("i",{class:"pi pi-wifi status-icon"}),e("span",null,"Menunggu kartu NFC...")],-1)])])):D("",!0),v.value?(p(),c("div",ea,[a[14]||(a[14]=e("h3",null,"Kartu Terdeteksi",-1)),e("div",ta,[a[13]||(a[13]=e("i",{class:"pi pi-user card-icon"},null,-1)),e("div",sa,[e("p",na,r(v.value.url),1),a[12]||(a[12]=e("p",{class:"card-status"},"Memproses data pengguna...",-1))])])])):D("",!0),l.value?(p(),c("div",la,[a[16]||(a[16]=e("h3",null,"Informasi Pengguna",-1)),e("div",oa,[a[15]||(a[15]=e("div",{class:"user-avatar"},[e("i",{class:"pi pi-user"})],-1)),e("div",ia,[e("h4",null,r(l.value.name),1),e("p",null,r(l.value.email),1)])]),e("div",ra,[n(o,{label:"Sholat",icon:"pi pi-check",onClick:a[2]||(a[2]=s=>N("sholat")),class:"p-button-success"}),n(o,{label:"Berhalangan",icon:"pi pi-times",onClick:a[3]||(a[3]=s=>N("halangan")),class:"p-button-warning"})])])):D("",!0),S.value.length>0?(p(),c("div",ua,[a[18]||(a[18]=e("h3",null,"Riwayat Scan Terbaru",-1)),n(A,{value:S.value,paginator:!0,rows:5},{list:k(s=>[(p(!0),c(J,null,Y(s.items,(w,j)=>(p(),c("div",{class:"history-item",key:j},[e("div",da,[e("div",ca,[a[17]||(a[17]=e("i",{class:"pi pi-user"},null,-1)),e("span",null,r(w.userName),1)]),e("div",{class:I(["history-status",w.status])},r(w.statusLabel),3),e("div",pa,r(w.time),1)])]))),128))]),_:1},8,["value"])])):D("",!0)]),_:1}),n(H,{visible:m.value,"onUpdate:visible":a[7]||(a[7]=s=>m.value=s),style:{width:"450px"},header:"Konfirmasi Kehadiran",modal:!0},{footer:k(()=>[n(o,{label:"Batal",icon:"pi pi-times",onClick:a[4]||(a[4]=s=>m.value=!1),class:"p-button-text"}),n(o,{label:"Berhalangan",icon:"pi pi-times",onClick:a[5]||(a[5]=s=>F("halangan")),class:"p-button-warning"}),n(o,{label:"Sholat",icon:"pi pi-check",onClick:a[6]||(a[6]=s=>F("sholat")),class:"p-button-success"})]),default:k(()=>[e("div",va,[a[19]||(a[19]=e("i",{class:"pi pi-exclamation-triangle"},null,-1)),e("span",null,"Apakah "+r(C.value)+" melakukan sholat pada "+r(P(f.value))+"?",1)])]),_:1},8,["visible"])])}}},ya=q(ma,[["__scopeId","data-v-1a3245a4"]]);export{ya as default};
