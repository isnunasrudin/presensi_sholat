import{a as B,r as _,m as U,c as t,f as s,b as i,w as N,d as h,p as g,o as n,g as I,l as x,h as p,n as u,t as m}from"./app-CnZCGkoq.js";import{_ as E}from"./_plugin-vue_export-helper-DlAUqK2U.js";const S={class:"profile"},D={class:"profile-header"},T={class:"profile-photo"},F=["src","alt"],z={key:1,class:"photo-placeholder"},G={class:"form-group"},H={class:"field"},K={key:0,class:"p-error"},L={class:"field"},R={key:0,class:"p-error"},$={class:"field"},A={key:0,class:"p-error"},W={class:"field"},j={key:0,class:"p-error"},q={class:"field"},J={key:0,class:"p-error"},O={class:"field"},Q={key:0,class:"p-error"},X={class:"field"},Y={key:0,class:"p-error"},Z={class:"form-actions"},ee={__name:"Profile",setup(ae){const v=B(),w=_(!1),o=_({}),f=_(null),a=_({name:"",email:"",phone:"",nisn:"",photo:null,current_password:"",password:"",password_confirmation:""}),y=()=>{f.value.click()},b=l=>{const e=l.target.files[0];if(e){if(!e.type.startsWith("image/")){v.add({severity:"error",summary:"Error",detail:"File harus berupa gambar",life:3e3});return}if(e.size>2*1024*1024){v.add({severity:"error",summary:"Error",detail:"Ukuran file maksimal 2MB",life:3e3});return}const d=new FileReader;d.onload=c=>{a.value.photo=c.target.result},d.readAsDataURL(e)}},V=()=>{a.value.photo=null,f.value.value=""},P=async()=>{try{const e=(await g.get("/profile")).data.user;a.value={name:e.name,email:e.email,phone:e.phone||"",nisn:e.nisn||"",photo:e.photo?`/storage/${e.photo}`:null,current_password:"",password:"",password_confirmation:""}}catch{v.add({severity:"error",summary:"Error",detail:"Gagal mengambil data profil",life:3e3})}},M=async()=>{o.value={},w.value=!0;try{const l=new FormData;l.append("name",a.value.name),l.append("email",a.value.email),l.append("phone",a.value.phone||""),l.append("nisn",a.value.nisn||""),f.value.files[0]&&l.append("photo",f.value.files[0]),a.value.current_password&&l.append("current_password",a.value.current_password),a.value.password&&(l.append("password",a.value.password),l.append("password_confirmation",a.value.password_confirmation)),l.append("_method","PUT");const e=await g.post("/profile",l,{headers:{"Content-Type":"multipart/form-data"}});v.add({severity:"success",summary:"Berhasil",detail:"Profil berhasil diperbarui",life:3e3});const d=e.data.user;a.value.photo=d.photo?`/storage/${d.photo}`:null}catch(l){l.response?.data?.errors?o.value=l.response.data.errors:v.add({severity:"error",summary:"Error",detail:l.response?.data?.message||"Gagal memperbarui profil",life:3e3})}finally{w.value=!1}};return U(()=>{P()}),(l,e)=>{const d=h("Button"),c=h("InputText"),k=h("Password"),C=h("Card");return n(),t("div",S,[e[16]||(e[16]=s("div",{class:"page-header"},[s("h1",{class:"page-title"},"Edit Profil")],-1)),i(C,null,{content:N(()=>[s("form",{onSubmit:I(M,["prevent"]),class:"profile-form"},[s("div",D,[s("div",T,[s("div",{class:"photo-preview",onClick:y},[a.value.photo?(n(),t("img",{key:0,src:a.value.photo,alt:a.value.name,class:"photo"},null,8,F)):(n(),t("div",z,[...e[7]||(e[7]=[s("i",{class:"pi pi-user"},null,-1)])])),e[8]||(e[8]=s("div",{class:"photo-overlay"},[s("i",{class:"pi pi-pencil"})],-1))]),s("input",{ref_key:"photoInput",ref:f,type:"file",accept:"image/*",onChange:b,class:"photo-input"},null,544),a.value.photo?(n(),x(d,{key:0,icon:"pi pi-trash",onClick:V,class:"remove-photo-btn",severity:"danger",text:""})):p("",!0)])]),s("div",G,[s("div",H,[e[9]||(e[9]=s("label",{for:"name"},"Nama Lengkap *",-1)),i(c,{id:"name",modelValue:a.value.name,"onUpdate:modelValue":e[0]||(e[0]=r=>a.value.name=r),placeholder:"Masukkan nama lengkap",class:u({"p-invalid":o.value.name})},null,8,["modelValue","class"]),o.value.name?(n(),t("small",K,m(o.value.name),1)):p("",!0)]),s("div",L,[e[10]||(e[10]=s("label",{for:"email"},"Email *",-1)),i(c,{id:"email",modelValue:a.value.email,"onUpdate:modelValue":e[1]||(e[1]=r=>a.value.email=r),type:"email",placeholder:"Masukkan email",class:u({"p-invalid":o.value.email})},null,8,["modelValue","class"]),o.value.email?(n(),t("small",R,m(o.value.email),1)):p("",!0)]),s("div",$,[e[11]||(e[11]=s("label",{for:"phone"},"Nomor HP",-1)),i(c,{id:"phone",modelValue:a.value.phone,"onUpdate:modelValue":e[2]||(e[2]=r=>a.value.phone=r),placeholder:"Masukkan nomor HP",class:u({"p-invalid":o.value.phone})},null,8,["modelValue","class"]),o.value.phone?(n(),t("small",A,m(o.value.phone),1)):p("",!0)]),s("div",W,[e[12]||(e[12]=s("label",{for:"nisn"},"NISN",-1)),i(c,{id:"nisn",modelValue:a.value.nisn,"onUpdate:modelValue":e[3]||(e[3]=r=>a.value.nisn=r),placeholder:"Masukkan NISN",class:u({"p-invalid":o.value.nisn})},null,8,["modelValue","class"]),o.value.nisn?(n(),t("small",j,m(o.value.nisn),1)):p("",!0)]),s("div",q,[e[13]||(e[13]=s("label",{for:"current_password"},"Password Saat Ini (untuk mengganti password)",-1)),i(k,{id:"current_password",modelValue:a.value.current_password,"onUpdate:modelValue":e[4]||(e[4]=r=>a.value.current_password=r),placeholder:"Masukkan password saat ini",feedback:!1,toggleMask:"",class:u({"p-invalid":o.value.current_password})},null,8,["modelValue","class"]),o.value.current_password?(n(),t("small",J,m(o.value.current_password),1)):p("",!0)]),s("div",O,[e[14]||(e[14]=s("label",{for:"password"},"Password Baru",-1)),i(k,{id:"password",modelValue:a.value.password,"onUpdate:modelValue":e[5]||(e[5]=r=>a.value.password=r),placeholder:"Masukkan password baru",feedback:!0,toggleMask:"",class:u({"p-invalid":o.value.password})},null,8,["modelValue","class"]),o.value.password?(n(),t("small",Q,m(o.value.password),1)):p("",!0)]),s("div",X,[e[15]||(e[15]=s("label",{for:"password_confirmation"},"Konfirmasi Password Baru",-1)),i(k,{id:"password_confirmation",modelValue:a.value.password_confirmation,"onUpdate:modelValue":e[6]||(e[6]=r=>a.value.password_confirmation=r),placeholder:"Konfirmasi password baru",feedback:!1,toggleMask:"",class:u({"p-invalid":o.value.password_confirmation})},null,8,["modelValue","class"]),o.value.password_confirmation?(n(),t("small",Y,m(o.value.password_confirmation),1)):p("",!0)])]),s("div",Z,[i(d,{type:"submit",label:"Simpan Perubahan",icon:"pi pi-check",loading:w.value,class:"p-button-success"},null,8,["loading"])])],32)]),_:1})])}}},le=E(ee,[["__scopeId","data-v-441695cf"]]);export{le as default};
