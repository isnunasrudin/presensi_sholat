import{r as _,I as y,w as N,p as T,d as i,q as U,e as a,c as d,y as v,j as b,F as P,A as Y,t as A,v as w}from"./vue-Bki0M6Jk.js";import{u as H}from"./primevue-DK4246gS.js";import{a as J}from"./app-Brb7QJ--.js";import{_ as L}from"./_plugin-vue_export-helper-DlAUqK2U.js";const O={class:"calendar-container"},E={class:"calendar-header"},R={class:"month-selector"},j={key:0,class:"loading-container"},q={key:1,class:"calendar-wrapper"},z={class:"calendar-grid"},W={class:"day-number"},G={class:"prayer-boxes"},K=["title"],Q={key:0,class:"pi pi-check"},X={key:1,class:"pi pi-times-circle"},Z={key:2,class:"pi pi-minus-circle"},ee=["title"],ae={key:0,class:"pi pi-check"},te={key:1,class:"pi pi-times-circle"},se={key:2,class:"pi pi-minus-circle"},le={__name:"UserMonthlyCalendar",props:{visible:Boolean,userId:Number,userName:String},emits:["update:visible"],setup(k,{emit:oe}){const h=k,x=H(),f=_(!1),m=_([]),D=new Date,n=_(D.getMonth()),c=_(D.getFullYear()),S=[{label:"Januari",value:0},{label:"Februari",value:1},{label:"Maret",value:2},{label:"April",value:3},{label:"Mei",value:4},{label:"Juni",value:5},{label:"Juli",value:6},{label:"Agustus",value:7},{label:"September",value:8},{label:"Oktober",value:9},{label:"November",value:10},{label:"Desember",value:11}],M=y(()=>{const s=new Date().getFullYear(),e=[];for(let t=s-2;t<=s+1;t++)e.push(t);return e}),C=y(()=>`${h.userName} - ${S[n.value].label} ${c.value}`),V=y(()=>{const s=c.value,e=n.value,t=new Date(s,e+1,0).getDate(),o=[];for(let r=1;r<=t;r++){const g=`${s}-${String(e+1).padStart(2,"0")}-${String(r).padStart(2,"0")}`,l=m.value.filter(I=>I.date.split("T")[0]===g);o.push({date:g,dayOfMonth:r,records:l})}return o}),p=async()=>{if(h.userId){f.value=!0;try{const s=c.value,e=n.value,t=`${s}-${String(e+1).padStart(2,"0")}-01`,o=`${s}-${String(e+1).padStart(2,"0")}-${new Date(s,e+1,0).getDate()}`,r=await J.get("/prayer-records",{params:{user_id:h.userId,start_date:t,end_date:o,per_page:1e3}});m.value=r.data.data||r.data||[],console.log("Fetched records:",m.value.length),console.log("Sample record:",m.value[0])}catch(s){console.error("Fetch error:",s),x.add({severity:"error",summary:"Error",detail:"Failed to fetch monthly data",life:3e3})}finally{f.value=!1}}},u=(s,e)=>{const t=s.records.find(o=>o.prayer_type===e);return console.log(`Day: ${s.date}, Type: ${e}, Record:`,t),t?t.status==="sholat"?"sholat":t.status==="halangan"?"halangan":(t.status==="tidak_sholat","tidak-hadir"):"tidak-hadir"},$=(s,e)=>{const t=s.records.find(r=>r.prayer_type===e),o=e==="dhuha"?"Dhuha":"Dhuhur";return t?t.status==="sholat"?`${o}: Sholat`:t.status==="halangan"?`${o}: Halangan${t.notes?" - "+t.notes:""}`:`${o}: Tidak Sholat`:`${o}: Tidak ada data`},F=()=>{n.value===0?(n.value=11,c.value--):n.value--,p()},B=()=>{n.value===11?(n.value=0,c.value++):n.value++,p()};return N(()=>h.visible,s=>{s&&h.userId&&p()}),(s,e)=>{const t=b("Button"),o=b("Dropdown"),r=b("ProgressSpinner"),g=b("Dialog");return i(),T(g,{visible:k.visible,header:C.value,modal:!0,style:{width:"95%",maxWidth:"900px"},"onUpdate:visible":e[2]||(e[2]=l=>s.$emit("update:visible",l))},{default:U(()=>[a("div",O,[a("div",E,[v(t,{icon:"pi pi-chevron-left",onClick:F,text:"",rounded:""}),a("div",R,[v(o,{modelValue:n.value,"onUpdate:modelValue":e[0]||(e[0]=l=>n.value=l),options:S,optionLabel:"label",optionValue:"value",onChange:p},null,8,["modelValue"]),v(o,{modelValue:c.value,"onUpdate:modelValue":e[1]||(e[1]=l=>c.value=l),options:M.value,onChange:p},null,8,["modelValue","options"])]),v(t,{icon:"pi pi-chevron-right",onClick:B,text:"",rounded:""})]),f.value?(i(),d("div",j,[v(r)])):(i(),d("div",q,[a("div",z,[(i(!0),d(P,null,Y(V.value,l=>(i(),d("div",{key:l.date,class:"day-cell"},[a("div",W,A(l.dayOfMonth),1),a("div",G,[a("div",{class:w(["prayer-box dhuha",u(l,"dhuha")]),title:$(l,"dhuha")},[u(l,"dhuha")==="sholat"?(i(),d("i",Q)):u(l,"dhuha")==="halangan"?(i(),d("i",X)):(i(),d("i",Z))],10,K),a("div",{class:w(["prayer-box dhuhur",u(l,"dhuhur")]),title:$(l,"dhuhur")},[u(l,"dhuhur")==="sholat"?(i(),d("i",ae)):u(l,"dhuhur")==="halangan"?(i(),d("i",te)):(i(),d("i",se))],10,ee)])]))),128))])])),e[3]||(e[3]=a("div",{class:"legend"},[a("div",{class:"legend-title"},"Status Sholat:"),a("div",{class:"legend-items"},[a("div",{class:"legend-item"},[a("div",{class:"legend-indicator sholat"},[a("i",{class:"pi pi-check"})]),a("span",null,"Sholat")]),a("div",{class:"legend-item"},[a("div",{class:"legend-indicator halangan"},[a("i",{class:"pi pi-exclamation-triangle"})]),a("span",null,"Halangan")]),a("div",{class:"legend-item"},[a("div",{class:"legend-indicator tidak-hadir"},[a("i",{class:"pi pi-minus"})]),a("span",null,"Tidak Hadir")])])],-1))])]),_:1},8,["visible","header"])}}},ue=L(le,[["__scopeId","data-v-68b9b1ed"]]);export{ue as U};
