import{a as T,r as m,z as f,A as I,l as U,o as c,w as A,f as l,c as g,b as v,d as b,F as H,s as P,t as Y,n as x,p as J}from"./app-BAyi6xf7.js";import{_ as L}from"./_plugin-vue_export-helper-DlAUqK2U.js";const O={class:"calendar-container"},z={class:"calendar-header"},E={class:"month-selector"},R={key:0,class:"loading-container"},K={key:1,class:"calendar-grid"},W={class:"day-number"},Z={class:"prayer-boxes"},j=["title"],q=["title"],G={__name:"UserMonthlyCalendar",props:{visible:Boolean,userId:Number,userName:String},emits:["update:visible"],setup(y,{emit:Q}){const d=y,M=T(),_=m(!1),h=m([]),D=new Date,n=m(D.getMonth()),i=m(D.getFullYear()),k=[{label:"Januari",value:0},{label:"Februari",value:1},{label:"Maret",value:2},{label:"April",value:3},{label:"Mei",value:4},{label:"Juni",value:5},{label:"Juli",value:6},{label:"Agustus",value:7},{label:"September",value:8},{label:"Oktober",value:9},{label:"November",value:10},{label:"Desember",value:11}],w=f(()=>{const t=new Date().getFullYear(),e=[];for(let a=t-2;a<=t+1;a++)e.push(a);return e}),C=f(()=>`${d.userName} - ${k[n.value].label} ${i.value}`),V=f(()=>{const t=i.value,e=n.value,a=new Date(t,e+1,0).getDate(),s=[];for(let r=1;r<=a;r++){const p=`${t}-${String(e+1).padStart(2,"0")}-${String(r).padStart(2,"0")}`,o=h.value.filter(N=>N.date.split("T")[0]===p);s.push({date:p,dayOfMonth:r,records:o})}return s}),u=async()=>{if(d.userId){_.value=!0;try{const t=i.value,e=n.value,a=`${t}-${String(e+1).padStart(2,"0")}-01`,s=`${t}-${String(e+1).padStart(2,"0")}-${new Date(t,e+1,0).getDate()}`,r=await J.get("/prayer-records",{params:{user_id:d.userId,start_date:a,end_date:s,per_page:1e3}});h.value=r.data.data||r.data||[],console.log("Fetched records:",h.value.length),console.log("Sample record:",h.value[0])}catch(t){console.error("Fetch error:",t),M.add({severity:"error",summary:"Error",detail:"Failed to fetch monthly data",life:3e3})}finally{_.value=!1}}},S=(t,e)=>{const a=t.records.find(s=>s.prayer_type===e);return console.log(`Day: ${t.date}, Type: ${e}, Record:`,a),a?a.status==="sholat"?"sholat":a.status==="halangan"?"halangan":(a.status==="tidak_sholat","tidak-hadir"):"tidak-hadir"},$=(t,e)=>{const a=t.records.find(r=>r.prayer_type===e),s=e==="dhuha"?"Dhuha":"Dhuhur";return a?a.status==="sholat"?`${s}: Sholat`:a.status==="halangan"?`${s}: Halangan${a.notes?" - "+a.notes:""}`:`${s}: Tidak Sholat`:`${s}: Tidak ada data`},F=()=>{n.value===0?(n.value=11,i.value--):n.value--,u()},B=()=>{n.value===11?(n.value=0,i.value++):n.value++,u()};return I(()=>d.visible,t=>{t&&d.userId&&u()}),(t,e)=>{const a=b("Button"),s=b("Dropdown"),r=b("ProgressSpinner"),p=b("Dialog");return c(),U(p,{visible:y.visible,header:C.value,modal:!0,style:{width:"90%",maxWidth:"800px"},"onUpdate:visible":e[2]||(e[2]=o=>t.$emit("update:visible",o))},{default:A(()=>[l("div",O,[l("div",z,[v(a,{icon:"pi pi-chevron-left",onClick:F,text:"",rounded:""}),l("div",E,[v(s,{modelValue:n.value,"onUpdate:modelValue":e[0]||(e[0]=o=>n.value=o),options:k,optionLabel:"label",optionValue:"value",onChange:u},null,8,["modelValue"]),v(s,{modelValue:i.value,"onUpdate:modelValue":e[1]||(e[1]=o=>i.value=o),options:w.value,onChange:u},null,8,["modelValue","options"])]),v(a,{icon:"pi pi-chevron-right",onClick:B,text:"",rounded:""})]),_.value?(c(),g("div",R,[v(r)])):(c(),g("div",K,[(c(!0),g(H,null,P(V.value,o=>(c(),g("div",{key:o.date,class:"day-cell"},[l("div",W,Y(o.dayOfMonth),1),l("div",Z,[l("div",{class:x(["prayer-box top",S(o,"dhuha")]),title:$(o,"dhuha")},null,10,j),l("div",{class:x(["prayer-box bottom",S(o,"dhuhur")]),title:$(o,"dhuhur")},null,10,q)])]))),128))])),e[3]||(e[3]=l("div",{class:"legend"},[l("div",{class:"legend-title"},"Keterangan:"),l("div",{class:"legend-items"},[l("div",{class:"legend-item"},[l("div",{class:"legend-box sholat"}),l("span",null,"Alpa Dhuha / Alpa Zuhur (Sholat)")]),l("div",{class:"legend-item"},[l("div",{class:"legend-box halangan"}),l("span",null,"Haid / Sakit (Halangan)")]),l("div",{class:"legend-item"},[l("div",{class:"legend-box tidak-hadir"}),l("span",null,"Tidak Hadir / Tidak Sholat")])])],-1))])]),_:1},8,["visible","header"])}}},te=L(G,[["__scopeId","data-v-775fe416"]]);export{te as U};
