import{r as p,o as te,c,e as s,y as l,p as I,s as i,R as $,q as m,j as v,k as se,d,t as u,v as k,h as L,l as N,D as le}from"./vue-Bki0M6Jk.js";import{u as oe,a as V}from"./app-CaNKOdJ-.js";import{x as re,y as ne}from"./primevue-BWgMG8pc.js";import{_ as de}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ie={class:"prayer-records"},ue={class:"page-header"},ce={class:"filters"},pe={class:"filter-group"},he={key:0,class:"filter-group"},me={class:"filter-group"},ve={class:"user-info"},_e={class:"user-name"},ye={class:"user-email"},be={class:"rombel-badge"},fe={class:"prayer-column"},ge={key:0,class:"notes-text"},De={class:"prayer-column"},ke={key:0,class:"notes-text"},Ve={class:"combined-notes"},Ce={key:0,class:"note-item"},Se={key:1,class:"note-item"},we={key:2,class:"no-notes"},xe={class:"delete-actions"},Re={key:0,class:"empty-state"},$e={key:0,class:"field"},Ae={key:0,class:"p-error"},Te={class:"field"},je={key:0,class:"p-error"},Ue={class:"field"},Be={key:0,class:"p-error"},Fe={class:"field"},He={key:0,class:"p-error"},Ke={class:"field"},Ee={class:"dialog-actions"},Ie={__name:"PrayerRecords",setup(Le){const h=oe(),b=re(),z=ne(),S=p([]),A=p([]),U=p([]),w=p(!1),T=p(!1),C=p(!1),x=p("create"),n=p({}),_=p(new Date),R=p({rombongan_belajar_id:null}),M=[{label:"Dhuhur",value:"dhuhur"},{label:"Dhuha",value:"dhuha"}],q=[{label:"Sholat",value:"sholat"},{label:"Tidak Sholat",value:"tidak_sholat"},{label:"Halangan",value:"halangan"}],o=p({id:null,user_id:null,prayer_type:null,date:new Date,status:null,notes:""}),O=async()=>{if(h.isAdmin)try{const a=await V.get("/users");A.value=a.data.data||a.data}catch(a){console.error("Failed to fetch users:",a)}},G=async()=>{if(h.isAdmin)try{const a=await V.get("/rombongan-belajar"),e=a.data.data||a.data;U.value=e.map(r=>({...r,nama_kelas:`${r.tingkat}-${r.nama_rombel}`}))}catch(a){console.error("Failed to fetch rombels:",a)}},f=async()=>{w.value=!0;try{const a={date:j(_.value)};R.value.rombongan_belajar_id&&(a.rombongan_belajar_id=R.value.rombongan_belajar_id);const e=await V.get("/prayer-records-daily-recap",{params:a});S.value=e.data}catch(a){console.error("Failed to fetch daily recap:",a),b.add({severity:"error",summary:"Error",detail:"Gagal mengambil data harian",life:3e3})}finally{w.value=!1}},J=(a=null)=>{n.value={},a?(x.value="edit",o.value={id:a.id,user_id:a.user_id,prayer_type:a.prayer_type,date:new Date(a.date),status:a.status,notes:a.notes||""}):(x.value="create",o.value={id:null,user_id:h.isAdmin?null:h.user.id,prayer_type:null,date:_.value,status:null,notes:""}),C.value=!0},Y=async()=>{n.value={},T.value=!0;try{const a={prayer_type:o.value.prayer_type,date:j(o.value.date),status:o.value.status,notes:o.value.notes};h.isAdmin&&(a.user_id=o.value.user_id),x.value==="edit"?(await V.put(`/prayer-records/${o.value.id}`,a),b.add({severity:"success",summary:"Success",detail:"Record updated successfully",life:3e3})):(await V.post("/prayer-records",a),b.add({severity:"success",summary:"Success",detail:"Record created successfully",life:3e3})),C.value=!1,f()}catch(a){a.response?.data?.errors?n.value=a.response.data.errors:b.add({severity:"error",summary:"Error",detail:a.response?.data?.message||"Failed to save record",life:3e3})}finally{T.value=!1}},B=(a,e)=>{if(!(e==="dhuha"?a.dhuha_record_id:a.dhuhur_record_id))return;const y=e==="dhuha"?"Dhuha":"Dhuhur";z.require({message:`Apakah Anda yakin ingin menghapus data sholat ${y} untuk ${a.name} pada ${F(_)}?`,header:"Konfirmasi Hapus",icon:"pi pi-exclamation-triangle",accept:()=>Q(a.user_id,j(_),e),reject:()=>{}})},Q=async(a,e,r)=>{try{await V.delete("/prayer-records-delete-by-user-date-type",{data:{user_id:a,date:e,prayer_type:r}}),b.add({severity:"success",summary:"Success",detail:`Data sholat ${r==="dhuha"?"Dhuha":"Dhuhur"} berhasil dihapus`,life:3e3}),f()}catch{b.add({severity:"error",summary:"Error",detail:"Failed to delete record",life:3e3})}},W=a=>A.value.find(r=>r.id===a)?.email||"",F=a=>new Date(a).toLocaleDateString("id-ID",{day:"numeric",month:"long",year:"numeric"}),j=a=>{if(!a)return null;const e=new Date(a),r=e.getFullYear(),y=String(e.getMonth()+1).padStart(2,"0"),g=String(e.getDate()).padStart(2,"0");return`${r}-${y}-${g}`},H=a=>({sholat:"prayer-badge success",tidak_sholat:"prayer-badge danger",halangan:"prayer-badge warning",null:"prayer-badge empty"})[a]||"prayer-badge empty",K=a=>({sholat:"OK",tidak_sholat:"-",halangan:"Halangan",null:"-"})[a]||"-";return te(()=>{f(),O(),G()}),(a,e)=>{const r=v("Button"),y=v("Calendar"),g=v("Dropdown"),D=v("Column"),X=v("DataTable"),Z=v("Card"),P=v("Textarea"),ee=v("Dialog"),E=se("tooltip");return d(),c("div",ie,[s("div",ue,[e[10]||(e[10]=s("h1",{class:"page-title"},"Catatan Sholat Harian",-1)),$(h).isAdmin?(d(),I(r,{key:0,label:"Tambah Catatan",icon:"pi pi-plus",onClick:e[0]||(e[0]=t=>J())})):i("",!0)]),l(Z,null,{content:m(()=>[s("div",ce,[s("div",pe,[e[11]||(e[11]=s("label",null,"Tanggal",-1)),l(y,{modelValue:_.value,"onUpdate:modelValue":e[1]||(e[1]=t=>_.value=t),dateFormat:"yy-mm-dd",onDateSelect:f,showIcon:!0},null,8,["modelValue"])]),$(h).isAdmin?(d(),c("div",he,[e[12]||(e[12]=s("label",null,"Kelas",-1)),l(g,{modelValue:R.value.rombongan_belajar_id,"onUpdate:modelValue":e[2]||(e[2]=t=>R.value.rombongan_belajar_id=t),options:[{id:null,nama_kelas:"Semua Kelas"},...U.value],optionLabel:"nama_kelas",optionValue:"id",placeholder:"Semua Kelas",onChange:f,filter:""},null,8,["modelValue","options"])])):i("",!0),s("div",me,[e[13]||(e[13]=s("label",null,"Â ",-1)),l(r,{label:"Refresh",icon:"pi pi-refresh",onClick:f,severity:"secondary"})])]),l(X,{value:S.value,loading:w.value,responsiveLayout:"scroll",class:"daily-recap-table mt-4",paginator:!0,rows:20,totalRecords:S.value.length,dataKey:"user_id"},{default:m(()=>[l(D,{field:"name",header:"Nama",sortable:""},{body:m(t=>[s("div",ve,[s("div",_e,u(t.data.name),1),s("div",ye,u(W(t.data.user_id)),1)])]),_:1}),l(D,{field:"rombel",header:"Kelas",sortable:""},{body:m(t=>[s("span",be,u(t.data.rombel),1)]),_:1}),l(D,{field:"dhuha_status",header:"Sholat Dhuha",sortable:""},{body:m(t=>[s("div",fe,[s("span",{class:k(H(t.data.dhuha_status))},u(K(t.data.dhuha_status)),3),t.data.dhuha_notes?(d(),c("small",ge,u(t.data.dhuha_notes),1)):i("",!0)])]),_:1}),l(D,{field:"dhuhur_status",header:"Sholat Dhuhur",sortable:""},{body:m(t=>[s("div",De,[s("span",{class:k(H(t.data.dhuhur_status))},u(K(t.data.dhuhur_status)),3),t.data.dhuhur_notes?(d(),c("small",ke,u(t.data.dhuhur_notes),1)):i("",!0)])]),_:1}),l(D,{header:"Catatan"},{body:m(t=>[s("div",Ve,[t.data.dhuha_notes?(d(),c("div",Ce,[e[14]||(e[14]=s("strong",null,"Dhuha:",-1)),L(" "+u(t.data.dhuha_notes),1)])):i("",!0),t.data.dhuhur_notes?(d(),c("div",Se,[e[15]||(e[15]=s("strong",null,"Dhuhur:",-1)),L(" "+u(t.data.dhuhur_notes),1)])):i("",!0),!t.data.dhuha_notes&&!t.data.dhuhur_notes?(d(),c("span",we," - ")):i("",!0)])]),_:1}),$(h).isAdmin?(d(),I(D,{key:0,header:"Hapus Data Rekap",style:{"min-width":"150px"}},{body:m(t=>[s("div",xe,[N(l(r,{icon:"pi pi-trash",label:"Hapus Dhuha",onClick:ae=>B(t.data,"dhuha"),severity:"warning",size:"small",text:"",disabled:!t.data.dhuha_record_id},null,8,["onClick","disabled"]),[[E,"Hapus data sholat Dhuha"]]),N(l(r,{icon:"pi pi-trash",label:"Hapus Dhuhur",onClick:ae=>B(t.data,"dhuhur"),severity:"danger",size:"small",text:"",disabled:!t.data.dhuhur_record_id},null,8,["onClick","disabled"]),[[E,"Hapus data sholat Dhuhur"]])])]),_:1})):i("",!0)]),_:1},8,["value","loading","totalRecords"]),!w.value&&S.value.length===0?(d(),c("div",Re,[e[16]||(e[16]=s("i",{class:"pi pi-inbox",style:{"font-size":"3rem",color:"#9ca3af"}},null,-1)),s("p",null,"Tidak ada data untuk tanggal "+u(F(_.value)),1)])):i("",!0)]),_:1}),l(ee,{visible:C.value,"onUpdate:visible":e[9]||(e[9]=t=>C.value=t),header:x.value==="create"?"Tambah Catatan Sholat":"Edit Catatan Sholat",modal:!0,style:{width:"500px"}},{default:m(()=>[s("form",{onSubmit:le(Y,["prevent"]),class:"dialog-form"},[$(h).isAdmin?(d(),c("div",$e,[e[17]||(e[17]=s("label",{for:"user_id"},"Pengguna *",-1)),l(g,{id:"user_id",modelValue:o.value.user_id,"onUpdate:modelValue":e[3]||(e[3]=t=>o.value.user_id=t),options:A.value,optionLabel:"name",optionValue:"id",placeholder:"Pilih pengguna",class:k({"p-invalid":n.value.user_id}),filter:""},null,8,["modelValue","options","class"]),n.value.user_id?(d(),c("small",Ae,u(n.value.user_id),1)):i("",!0)])):i("",!0),s("div",Te,[e[18]||(e[18]=s("label",{for:"prayer_type"},"Jenis Sholat *",-1)),l(g,{id:"prayer_type",modelValue:o.value.prayer_type,"onUpdate:modelValue":e[4]||(e[4]=t=>o.value.prayer_type=t),options:M.filter(t=>t.value),optionLabel:"label",optionValue:"value",placeholder:"Pilih jenis sholat",class:k({"p-invalid":n.value.prayer_type})},null,8,["modelValue","options","class"]),n.value.prayer_type?(d(),c("small",je,u(n.value.prayer_type),1)):i("",!0)]),s("div",Ue,[e[19]||(e[19]=s("label",{for:"date"},"Tanggal *",-1)),l(y,{id:"date",modelValue:o.value.date,"onUpdate:modelValue":e[5]||(e[5]=t=>o.value.date=t),dateFormat:"yy-mm-dd",class:k({"p-invalid":n.value.date})},null,8,["modelValue","class"]),n.value.date?(d(),c("small",Be,u(n.value.date),1)):i("",!0)]),s("div",Fe,[e[20]||(e[20]=s("label",{for:"status"},"Status *",-1)),l(g,{id:"status",modelValue:o.value.status,"onUpdate:modelValue":e[6]||(e[6]=t=>o.value.status=t),options:q,optionLabel:"label",optionValue:"value",placeholder:"Pilih status",class:k({"p-invalid":n.value.status})},null,8,["modelValue","class"]),n.value.status?(d(),c("small",He,u(n.value.status),1)):i("",!0)]),s("div",Ke,[e[21]||(e[21]=s("label",{for:"notes"},"Catatan",-1)),l(P,{id:"notes",modelValue:o.value.notes,"onUpdate:modelValue":e[7]||(e[7]=t=>o.value.notes=t),rows:"3",placeholder:"Tambahkan catatan..."},null,8,["modelValue"])]),s("div",Ee,[l(r,{label:"Batal",onClick:e[8]||(e[8]=t=>C.value=!1),severity:"secondary",text:""}),l(r,{type:"submit",label:"Simpan",loading:T.value},null,8,["loading"])])],32)]),_:1},8,["visible","header"])])}}},Oe=de(Ie,[["__scopeId","data-v-e2bce508"]]);export{Oe as default};
