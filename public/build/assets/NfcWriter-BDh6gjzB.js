import{r as n,o as C,c as d,e as a,y as c,q as W,j as m,d as p,s as k,t as N,v as g}from"./vue-Bki0M6Jk.js";import{x as A}from"./primevue-BWgMG8pc.js";import{a as E}from"./app-BtTGz4Tf.js";import{_ as I}from"./_plugin-vue_export-helper-DlAUqK2U.js";const R={class:"nfc-writer"},D={class:"writer-content"},L={class:"user-selection"},x={class:"field"},B={key:0,class:"url-preview"},S={class:"url-display"},T={class:"write-section"},V={key:0,class:"nfc-not-supported"},G={__name:"NfcWriter",setup($){const l=A(),f=n([]),t=n(null),s=n(""),v=n(!1),o=n(!1),u=n(!1),r=n(null);C(()=>{"NDEFReader"in window?(u.value=!0,console.log("Web NFC API is supported")):(u.value=!1,console.log("Web NFC API is not supported"),l.add({severity:"warn",summary:"Peringatan",detail:"Web NFC API tidak didukung di browser ini. Fitur write NFC tidak akan berfungsi.",life:5e3}))});const w=async()=>{v.value=!0;try{const i=await E.get("/users");f.value=i.data.data||i.data}catch{l.add({severity:"error",summary:"Error",detail:"Gagal mengambil daftar pengguna",life:3e3})}finally{v.value=!1}},b=()=>{t.value?s.value=`${window.location.origin}/u/${t.value}`:s.value=""},F=async()=>{try{await navigator.clipboard.writeText(s.value),l.add({severity:"success",summary:"Berhasil",detail:"URL telah disalin ke clipboard",life:3e3})}catch{l.add({severity:"error",summary:"Error",detail:"Gagal menyalin URL ke clipboard",life:3e3})}},h=async()=>{if(!u.value){l.add({severity:"error",summary:"Error",detail:"Web NFC API tidak didukung di browser ini. Gunakan Chrome/Edge di Android.",life:5e3});return}if(!t.value){l.add({severity:"warn",summary:"Peringatan",detail:"Harap pilih pengguna terlebih dahulu",life:3e3});return}if(!s.value){l.add({severity:"warn",summary:"Peringatan",detail:"URL tidak valid",life:3e3});return}o.value=!0,r.value=null;try{const i=new NDEFReader;l.add({severity:"info",summary:"Info",detail:"Dekatkan tag NFC ke perangkat Anda...",life:2e3}),await i.write({records:[{recordType:"url",data:s.value},{recordType:"text",data:s.value}]}),r.value={type:"success",icon:"pi pi-check-circle",message:`Berhasil menulis URL ke tag NFC untuk user ID: ${t.value}`},l.add({severity:"success",summary:"Berhasil",detail:`URL ${s.value} telah berhasil ditulis ke tag NFC`,life:5e3})}catch(i){console.error("NFC write error:",i);let e="Gagal menulis ke NFC";i.name==="NotAllowedError"?e="Izin NFC ditolak. Aktifkan NFC dan berikan izin melalui browser.":i.name==="NotSupportedError"?e="Perangkat tidak mendukung NFC.":i.name==="NetworkError"?e="Tag NFC tidak terdeteksi. Dekatkan tag ke perangkat dan coba lagi.":i.message&&(e=i.message),r.value={type:"error",icon:"pi pi-times-circle",message:e},l.add({severity:"error",summary:"Error",detail:e,life:5e3})}finally{o.value=!1}};return C(()=>{w()}),(i,e)=>{const _=m("Dropdown"),y=m("Button"),P=m("Card");return p(),d("div",R,[e[8]||(e[8]=a("div",{class:"page-header"},[a("h1",{class:"page-title"},"Write NFC Tag")],-1)),c(P,null,{content:W(()=>[a("div",D,[e[7]||(e[7]=a("div",{class:"info-section"},[a("h3",null,"Informasi Write NFC"),a("p",null,"Gunakan halaman ini untuk menulis URL ke tag NFC. Pastikan perangkat Anda mendukung Web NFC API.")],-1)),a("div",L,[e[2]||(e[2]=a("h3",null,"Pilih Pengguna",-1)),a("div",x,[e[1]||(e[1]=a("label",{for:"userSelect"},"Pengguna",-1)),c(_,{id:"userSelect",modelValue:t.value,"onUpdate:modelValue":e[0]||(e[0]=U=>t.value=U),options:f.value,optionLabel:"name",optionValue:"id",placeholder:"Pilih pengguna",loading:v.value,onChange:b},null,8,["modelValue","options","loading"])])]),t.value?(p(),d("div",B,[e[3]||(e[3]=a("h3",null,"URL yang akan ditulis",-1)),a("div",S,[a("p",null,N(s.value),1),c(y,{icon:"pi pi-copy",onClick:F,class:"p-button-outlined",label:"Salin URL"})])])):k("",!0),a("div",T,[e[5]||(e[5]=a("h3",null,"Write ke NFC",-1)),e[6]||(e[6]=a("div",{class:"write-instructions"},[a("p",null,"1. Pastikan NFC pada perangkat Anda aktif"),a("p",null,"2. Dekatkan tag NFC ke perangkat"),a("p",null,'3. Klik tombol "Write ke NFC" di bawah')],-1)),c(y,{label:o.value?"Menulis ke NFC...":"Write ke NFC",icon:o.value?"pi pi-spin pi-spinner":"pi pi-qrcode",onClick:h,disabled:!t.value||o.value||!u.value,class:g({"p-button-success":!o.value})},null,8,["label","icon","disabled","class"]),u.value?k("",!0):(p(),d("div",V,[...e[4]||(e[4]=[a("i",{class:"pi pi-exclamation-triangle"},null,-1),a("span",null,"Web NFC API tidak didukung di browser ini",-1)])]))]),r.value?(p(),d("div",{key:1,class:g(["write-result",r.value.type])},[a("i",{class:g(r.value.icon)},null,2),a("span",null,N(r.value.message),1)],2)):k("",!0)])]),_:1})])}}},H=I(G,[["__scopeId","data-v-9be02d92"]]);export{H as default};
